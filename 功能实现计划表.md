# Coach Daily åŠŸèƒ½å®ç°è®¡åˆ’è¡¨

**ç”Ÿæˆæ—¥æœŸï¼š** 2025-12-04
**é¡¹ç›®çŠ¶æ€ï¼š** MVPå¼€å‘é˜¶æ®µ

---

## ç›®å½•
- [ä¸€ã€åŠŸèƒ½å®Œæˆåº¦æ€»è§ˆ](#ä¸€åŠŸèƒ½å®Œæˆåº¦æ€»è§ˆ)
- [äºŒã€å·²å®ŒæˆåŠŸèƒ½ âœ…](#äºŒå·²å®ŒæˆåŠŸèƒ½-)
- [ä¸‰ã€æœªå®ŒæˆåŠŸèƒ½æ¸…å•](#ä¸‰æœªå®ŒæˆåŠŸèƒ½æ¸…å•)
- [å››ã€è¯¦ç»†å®ç°è®¡åˆ’](#å››è¯¦ç»†å®ç°è®¡åˆ’)
- [äº”ã€å¼€å‘ä¼˜å…ˆçº§å»ºè®®](#äº”å¼€å‘ä¼˜å…ˆçº§å»ºè®®)

---

## ä¸€ã€åŠŸèƒ½å®Œæˆåº¦æ€»è§ˆ

| æ¨¡å—ç¼–å· | æ¨¡å—åç§° | éœ€æ±‚ä¼˜å…ˆçº§ | å®ç°çŠ¶æ€ | å®Œæˆåº¦ | å¤‡æ³¨ |
|---------|---------|-----------|---------|--------|------|
| M1 | è´¦å·æ¨¡å— | P0 | âœ… å®Œæˆ | 100% | æ³¨å†Œã€ç™»å½•ã€JWTè®¤è¯ |
| M2 | é¦–é¡µ & å¿«é€Ÿè®°å½• | P0 | âš ï¸ éƒ¨åˆ†å®Œæˆ | 85% | Readingå¿«é€Ÿè®°å½•æœªå®ç° |
| M3-è¿åŠ¨ | è¿åŠ¨è®°å½• | P0 | âœ… å®Œæˆ | 100% | å®Œæ•´Cleanæ¶æ„ |
| M3-é¥®é£Ÿ | é¥®é£Ÿè®°å½• | P0 | âš ï¸ éƒ¨åˆ†å®Œæˆ | 85% | ç¼ºå°‘AIè¯†åˆ«åŠŸèƒ½ |
| M3-ç¡çœ  | ç¡çœ è®°å½• | P0 | âœ… å®Œæˆ | 100% | å®Œæ•´å®ç° |
| M3-å·¥ä½œ | å·¥ä½œè®°å½• | P0 | âœ… å®Œæˆ | 100% | Focus Sessionså®Œæ•´ |
| M3-é˜…è¯» | é˜…è¯»è®°å½• | P0 | âŒ æœªå®ç° | 0% | å‰åç«¯å®Œå…¨ç¼ºå¤± |
| M4 | å¤œé—´å¤ç›˜ | P0 | âš ï¸ éƒ¨åˆ†å®Œæˆ | 40% | åŸºç¡€reviewå®ç°ï¼Œç¼ºAIåŠŸèƒ½ |
| M5 | æ˜æ—¥è®¡åˆ’ | P1 | âŒ æœªå®ç° | 0% | å®Œå…¨ç¼ºå¤± |
| M6 | ç»Ÿè®¡æ¨¡å— | P0 | âš ï¸ éƒ¨åˆ†å®Œæˆ | 30% | ä»…è¿åŠ¨ç»Ÿè®¡ï¼Œç¼ºç»¼åˆç»Ÿè®¡ |
| M7 | å¤ç›˜å†å² | P1 | âš ï¸ éƒ¨åˆ†å®Œæˆ | 60% | åˆ—è¡¨å’Œè¯¦æƒ…å­˜åœ¨ï¼Œç¼ºç¼–è¾‘ |
| M8-ç›®æ ‡ | ç›®æ ‡è®¾ç½® | P0 | âš ï¸ éƒ¨åˆ†å®Œæˆ | 20% | æœ‰æ¨¡å‹æ— UI |
| M8-é€šçŸ¥ | é€šçŸ¥è®¾ç½® | P0 | âŒ æœªå®ç° | 10% | ä»…UIå¼€å…³ï¼Œæ— åŠŸèƒ½ |
| M8-èµ„æ–™ | ä¸ªäººèµ„æ–™ | P0 | âœ… å®Œæˆ | 100% | å®Œæ•´å®ç° |
| M9 | æ•°æ®å¯¼å‡ºä¸æ¸…ç† | P1 | âŒ æœªå®ç° | 0% | å®Œå…¨ç¼ºå¤± |
| é¢å¤– | MomentsåŠŸèƒ½ | - | âœ… å®Œæˆ | 100% | éœ€æ±‚å¤–çš„é¢å¤–åŠŸèƒ½ |

**æ€»ä½“å®Œæˆåº¦ï¼š** çº¦ 60%

---

## äºŒã€å·²å®ŒæˆåŠŸèƒ½ âœ…

### 2.1 å®Œå…¨å®ç°çš„æ¨¡å—

#### M1 - è´¦å·æ¨¡å—
- **å‰ç«¯ï¼š** `lib/features/auth/`
  - ç™»å½•é¡µé¢ (`login_page.dart`)
  - æ³¨å†Œé¡µé¢ (`register_page.dart`)
  - ç»Ÿä¸€Authç»„ä»¶ (`auth_widgets.dart`)
- **åç«¯ï¼š** `server/src/routes/auth.js`
  - POST `/api/auth/register` - ç”¨æˆ·æ³¨å†Œ
  - POST `/api/auth/login` - ç”¨æˆ·ç™»å½•
  - JWT Tokenç”Ÿæˆä¸éªŒè¯
  - bcryptå¯†ç åŠ å¯†
- **æ•°æ®åº“ï¼š** `users` è¡¨å®Œæ•´

#### M3-è¿åŠ¨ - è¿åŠ¨è®°å½•æ¨¡å—
- **å‰ç«¯ï¼š** `lib/features/sports/` (Clean Architectureå®Œæ•´)
  - Presentation: `sports_page.dart`, `manual_entry_page.dart`
  - Application: `sports_providers.dart`
  - Domain: `workout_record.dart` (Freezed models)
  - Data: `workout_repository.dart`
- **åç«¯ï¼š** `server/src/routes/workouts.js`
  - GET `/api/workouts` - è·å–è¿åŠ¨è®°å½•åˆ—è¡¨
  - GET `/api/workouts/:id` - è·å–å•ä¸ªè®°å½•
  - POST `/api/workouts` - åˆ›å»º/æ›´æ–°è®°å½•
  - DELETE `/api/workouts/:id` - åˆ é™¤è®°å½•
- **æ•°æ®åº“ï¼š** `workout_records` è¡¨å®Œæ•´
- **åŠŸèƒ½ï¼š** ç±»å‹ã€æ—¶é•¿ã€è·ç¦»ã€å¡è·¯é‡Œã€å¤‡æ³¨ã€æœ¬åœ°ç¼“å­˜

#### M3-é¥®é£Ÿ - é¥®é£Ÿè®°å½•æ¨¡å—ï¼ˆ85%ï¼‰
- **å‰ç«¯ï¼š** `lib/features/diet/` (Clean Architectureå®Œæ•´)
  - Presentation: `diet_page.dart`, `ai_food_recognition_page.dart`
  - Application: `diet_providers.dart`
  - Domain: `diet_models.dart` (MealRecord, FoodItem)
  - Data: `diet_repository.dart`
- **åç«¯ï¼š** `server/src/routes/meals.js`
  - GET `/api/meals` - è·å–é¥®é£Ÿè®°å½•
  - POST `/api/meals` - åˆ›å»º/æ›´æ–°è®°å½•
  - DELETE `/api/meals/:id` - åˆ é™¤è®°å½•
- **æ•°æ®åº“ï¼š** `meal_records` å’Œ `food_items` è¡¨å®Œæ•´
- **åŠŸèƒ½ï¼š** é¤åˆ«åˆ†ç±»ã€è¥å…»è¿½è¸ªã€æ¯æ—¥ç›®æ ‡
- **ç¼ºå¤±ï¼š** AIé£Ÿç‰©è¯†åˆ«æ¥å£ï¼ˆUIæœ‰ä½†hardcodedï¼‰

#### M3-ç¡çœ  - ç¡çœ è®°å½•æ¨¡å—
- **å‰ç«¯ï¼š** `lib/features/sleep/` (Clean Architectureå®Œæ•´)
- **åç«¯ï¼š** `server/src/routes/sleep.js` (å®Œæ•´CRUD)
- **æ•°æ®åº“ï¼š** `sleep_records` è¡¨å®Œæ•´
- **åŠŸèƒ½ï¼š** å°±å¯/èµ·åºŠæ—¶é—´ã€ç¡çœ è´¨é‡ã€æ—¶é•¿è®¡ç®—ã€å‘¨ç»Ÿè®¡

#### M3-å·¥ä½œ - å·¥ä½œè®°å½•æ¨¡å—
- **å‰ç«¯ï¼š** `lib/features/work/` (Clean Architectureå®Œæ•´)
- **åç«¯ï¼š** `server/src/routes/focus.js` (å®Œæ•´CRUD)
- **æ•°æ®åº“ï¼š** `focus_sessions` è¡¨å®Œæ•´
- **åŠŸèƒ½ï¼š** Pomodoroè®¡æ—¶å™¨ã€ä»»åŠ¡å‘½åã€ä¼šè¯å†å²

#### M4 - æ—¥å¸¸å¤ç›˜ï¼ˆåŸºç¡€ç‰ˆï¼‰
- **å‰ç«¯ï¼š** `lib/features/review/` (Clean Architectureå®Œæ•´)
- **åç«¯ï¼š** `server/src/routes/reviews.js` (å®Œæ•´CRUD)
- **æ•°æ®åº“ï¼š** `review_entries` è¡¨å®Œæ•´
- **åŠŸèƒ½ï¼š** å¿ƒæƒ…ã€äº®ç‚¹ã€æ”¹è¿›ã€æ˜æ—¥è®¡åˆ’çš„æ–‡æœ¬è®°å½•

#### M8-èµ„æ–™ - ä¸ªäººèµ„æ–™æ¨¡å—
- **å‰ç«¯ï¼š** `lib/features/profile/`
  - `profile_page.dart` - èµ„æ–™æŸ¥çœ‹
  - `edit_profile_page.dart` - èµ„æ–™ç¼–è¾‘
- **åç«¯ï¼š** `server/src/routes/profile.js`
  - GET `/api/profile` - è·å–èµ„æ–™
  - PUT `/api/profile` - æ›´æ–°èµ„æ–™
- **åŠŸèƒ½ï¼š** æ˜µç§°ã€Emojiå¤´åƒã€ä¸ªäººç®€ä»‹ã€åå¥½è®¾ç½®

#### é¢å¤–åŠŸèƒ½ - Momentsï¼ˆç…§ç‰‡å¢™ï¼‰
- **å‰ç«¯ï¼š** `lib/features/moments/` (å®Œæ•´å®ç°)
- **åç«¯ï¼š** å¾…ç¡®è®¤ï¼ˆå¯èƒ½ä½¿ç”¨æœ¬åœ°å­˜å‚¨ï¼‰
- **åŠŸèƒ½ï¼š** ç…§ç‰‡ä¸Šä¼ ã€ç€‘å¸ƒæµå±•ç¤ºã€æ—¶åˆ»è®°å½•

---

## ä¸‰ã€æœªå®ŒæˆåŠŸèƒ½æ¸…å•

### 3.1 å®Œå…¨ç¼ºå¤±çš„åŠŸèƒ½ âŒ

#### 1ï¸âƒ£ M3-é˜…è¯» - é˜…è¯»è®°å½•æ¨¡å—ï¼ˆä¼˜å…ˆçº§ï¼šP0ï¼‰
**å½±å“èŒƒå›´ï¼š**
- Dashboardä¸­readingå¡ç‰‡æ— æ•°æ®
- å¿«é€Ÿè®°å½•ä¸­readingå…¥å£ä¸å¯ç”¨
- ç»Ÿè®¡é¡µé¢æ— é˜…è¯»æ•°æ®

**ç¼ºå¤±å†…å®¹ï¼š**
- âŒ å‰ç«¯ï¼šæ—  `lib/features/reading/` ç›®å½•
- âŒ åç«¯ï¼šæ—  `/api/reading` è·¯ç”±
- âŒ æ•°æ®åº“ï¼šæ—  `reading_records` è¡¨
- âŒ è·¯ç”±ï¼šæœªåœ¨ `app_routes.dart` ä¸­æ³¨å†Œ

**éœ€è¦å®ç°ï¼š**
```
å‰ç«¯ (lib/features/reading/):
â”œâ”€â”€ presentation/
â”‚   â”œâ”€â”€ reading_page.dart          # é˜…è¯»è®°å½•é¡µé¢
â”‚   â””â”€â”€ widgets/                   # ç›¸å…³ç»„ä»¶
â”œâ”€â”€ application/
â”‚   â””â”€â”€ reading_providers.dart     # RiverpodçŠ¶æ€ç®¡ç†
â”œâ”€â”€ domain/
â”‚   â””â”€â”€ reading_record.dart        # Freezedæ•°æ®æ¨¡å‹
â””â”€â”€ data/
    â””â”€â”€ reading_repository.dart    # API + æœ¬åœ°ç¼“å­˜

åç«¯ (server/src/routes/):
â””â”€â”€ reading.js                     # CRUD API

æ•°æ®åº“:
â””â”€â”€ reading_records è¡¨
```

#### 2ï¸âƒ£ M5 - æ˜æ—¥è®¡åˆ’æ¨¡å—ï¼ˆä¼˜å…ˆçº§ï¼šP1ï¼‰
**åŠŸèƒ½æè¿°ï¼š** åŸºäºå¤ç›˜å’Œç”¨æˆ·ç›®æ ‡ï¼Œç”±AIç”Ÿæˆçš„æ¬¡æ—¥è¡ŒåŠ¨å»ºè®®

**ç¼ºå¤±å†…å®¹ï¼š**
- âŒ å‰ç«¯ï¼šæ— è®¡åˆ’é¡µé¢/ç»„ä»¶
- âŒ åç«¯ï¼šæ— AIç”Ÿæˆæ¥å£
- âŒ æ•°æ®åº“ï¼šreview_entriesè¡¨ä¸­çš„tomorrow_planså­—æ®µæœªè¢«AIä½¿ç”¨

**éœ€è¦å®ç°ï¼š**
- AIæœåŠ¡é›†æˆï¼ˆè°ƒç”¨å¤§æ¨¡å‹APIï¼‰
- æ˜æ—¥è®¡åˆ’ç”Ÿæˆé€»è¾‘
- è®¡åˆ’å±•ç¤ºé¡µé¢ï¼ˆå¯åœ¨Dashboardæˆ–Reviewä¸­ï¼‰
- æ¬¡æ—¥æ—©æ™¨è®¡åˆ’æ¨é€é€šçŸ¥

#### 3ï¸âƒ£ M8-é€šçŸ¥ - é€šçŸ¥ä¸æé†’ç³»ç»Ÿï¼ˆä¼˜å…ˆçº§ï¼šP0ï¼‰
**åŠŸèƒ½æè¿°ï¼š** å¤œé—´å¤ç›˜æé†’ã€æ—©æ™¨è®¡åˆ’æé†’ã€è‡ªå®šä¹‰æé†’

**ç¼ºå¤±å†…å®¹ï¼š**
- âŒ å‰ç«¯ï¼šæ— é€šçŸ¥æœåŠ¡ (`NotificationService`)
- âŒ åç«¯ï¼šæ— æ¨é€æœåŠ¡é›†æˆ
- âŒ é…ç½®ï¼šæ— Firebase/APNsé…ç½®
- âŒ åå°ä»»åŠ¡ï¼šæ— å®šæ—¶ä»»åŠ¡è°ƒåº¦

**éœ€è¦å®ç°ï¼š**
- æœ¬åœ°é€šçŸ¥æœåŠ¡ï¼ˆflutter_local_notificationsï¼‰
- å¯é€‰ï¼šäº‘æ¨é€æœåŠ¡ï¼ˆFirebase Cloud Messagingï¼‰
- é€šçŸ¥æƒé™è¯·æ±‚
- å®šæ—¶ä»»åŠ¡è°ƒåº¦
- é€šçŸ¥è®¾ç½®UIï¼ˆå·²æœ‰ä½†ä¸ç”Ÿæ•ˆï¼‰

#### 4ï¸âƒ£ M9 - æ•°æ®å¯¼å‡ºä¸æ¸…ç†ï¼ˆä¼˜å…ˆçº§ï¼šP1ï¼‰
**åŠŸèƒ½æè¿°ï¼š** å¯¼å‡ºæ‰€æœ‰è®°å½•æ•°æ®ã€åˆ é™¤è´¦æˆ·åŠæ•°æ®

**ç¼ºå¤±å†…å®¹ï¼š**
- âŒ å‰ç«¯ï¼šæ— å¯¼å‡ºåŠŸèƒ½UI
- âŒ åç«¯ï¼šæ— å¯¼å‡ºAPI
- âŒ åç«¯ï¼šæ— è´¦æˆ·åˆ é™¤API

**éœ€è¦å®ç°ï¼š**
- æ•°æ®å¯¼å‡ºä¸ºJSON/CSV
- æ•°æ®åˆ é™¤ç¡®è®¤æµç¨‹
- è´¦æˆ·æ³¨é”€æµç¨‹
- è®¾ç½®é¡µé¢ä¸­çš„å…¥å£

---

### 3.2 éƒ¨åˆ†å®ç°çš„åŠŸèƒ½ âš ï¸

#### 1ï¸âƒ£ M2 - Dashboardå¿«é€Ÿè®°å½•ï¼ˆå®Œæˆåº¦ï¼š85%ï¼‰
**é—®é¢˜ï¼š**
- Readingå¿«é€Ÿè®°å½•å…¥å£å­˜åœ¨ä½†ä¸å¯ç”¨
- å¿«é€Ÿè®°å½•ä¿å­˜åï¼Œéƒ¨åˆ†å¡ç‰‡æ•°æ®ä¸åˆ·æ–°

**éœ€è¦ä¿®å¤ï¼š**
- å®ç°Readingè®°å½•çš„ä¿å­˜é€»è¾‘ï¼ˆä¾èµ–M3-é˜…è¯»æ¨¡å—ï¼‰
- ä¼˜åŒ–Dashboardæ•°æ®åˆ·æ–°æœºåˆ¶

**æ–‡ä»¶ä½ç½®ï¼š**
- `lib/features/dashboard/presentation/dashboard_page.dart`
- `lib/features/dashboard/presentation/widgets/quick_record_sheet.dart`

#### 2ï¸âƒ£ M4 - å¤œé—´å¤ç›˜AIåŠŸèƒ½ï¼ˆå®Œæˆåº¦ï¼š40%ï¼‰
**å·²æœ‰åŠŸèƒ½ï¼š**
- âœ… åŸºç¡€çš„reviewè®°å½•ï¼ˆå¿ƒæƒ…ã€äº®ç‚¹ã€æ”¹è¿›ã€è®¡åˆ’ï¼‰
- âœ… å¤ç›˜åˆ—è¡¨å’Œè¯¦æƒ…é¡µ
- âœ… æ•°æ®æŒä¹…åŒ–

**ç¼ºå¤±åŠŸèƒ½ï¼š**
- âŒ å¼•å¯¼å¼æé—®æµç¨‹ï¼ˆéœ€æ±‚æ–‡æ¡£ä¸­çš„3-5ä¸ªé—®é¢˜ï¼‰
- âŒ AIç”Ÿæˆå¤ç›˜æŠ¥å‘Šï¼ˆå…³é”®è¯ã€åšå¾—å¥½ã€å¯æ”¹è¿›ï¼‰
- âŒ ç»¼åˆå½“æ—¥å„ç»´åº¦æ•°æ®
- âŒ å¤œé—´å®šæ—¶æé†’ï¼ˆä¾èµ–é€šçŸ¥ç³»ç»Ÿï¼‰
- âŒ AIæ€»ç»“åŠŸèƒ½

**éœ€è¦å®ç°ï¼š**
1. **å¤œé—´å¤ç›˜é¡µé¢é‡æ„ï¼š**
   - å½“æ—¥æ¦‚è§ˆï¼ˆè¿åŠ¨/é¥®é£Ÿ/ç¡çœ /å·¥ä½œ/é˜…è¯»æ±‡æ€»ï¼‰
   - å¼•å¯¼å¼æé—®äº¤äº’
   - é—®é¢˜å›ç­”è¡¨å•
2. **AIæœåŠ¡é›†æˆï¼š**
   - åç«¯AIæ¥å£ (`POST /api/reviews/generate-summary`)
   - Promptå·¥ç¨‹ï¼ˆåŒ…å«å½“æ—¥æ•°æ®+ç”¨æˆ·å›ç­”+ç”¨æˆ·ç›®æ ‡ï¼‰
   - AIæŠ¥å‘Šæ¸²æŸ“ç»„ä»¶
3. **å¤ç›˜æŠ¥å‘Šç»“æ„ï¼š**
   ```json
   {
     "keywords": ["é«˜æ•ˆ", "ç–²åŠ³", "è¿›æ­¥"],
     "highlights": ["å®Œæˆ3ä¸ªé‡è¦ä»»åŠ¡", "è·‘æ­¥5å…¬é‡Œ"],
     "improvements": ["ç¡çœ ä¸è¶³", "åˆé¤çƒ­é‡è¿‡é«˜"],
     "suggestions": ["æ˜å¤©æå‰30åˆ†é’Ÿç¡è§‰", "å¢åŠ è”¬èœæ‘„å…¥"]
   }
   ```

**æ–‡ä»¶ä½ç½®ï¼š**
- å‰ç«¯ï¼š`lib/features/review/presentation/review_page.dart`
- åç«¯ï¼š`server/src/routes/reviews.js` (éœ€æ–°å¢AI endpoint)

#### 3ï¸âƒ£ M6 - ç»Ÿè®¡æ¨¡å—ï¼ˆå®Œæˆåº¦ï¼š30%ï¼‰
**å·²æœ‰åŠŸèƒ½ï¼š**
- âœ… Statsé¡µé¢æ¡†æ¶
- âœ… è¿åŠ¨æ•°æ®çš„å‘¨/æœˆç»Ÿè®¡
- âœ… å›¾è¡¨å±•ç¤ºï¼ˆfl_chartï¼‰

**ç¼ºå¤±åŠŸèƒ½ï¼š**
- âŒ é¥®é£Ÿç»Ÿè®¡ï¼ˆçƒ­é‡è¶‹åŠ¿ã€è¥å…»åˆ†å¸ƒï¼‰
- âŒ ç¡çœ ç»Ÿè®¡ï¼ˆç¡çœ æ—¶é•¿è¶‹åŠ¿ã€è´¨é‡åˆ†æï¼‰
- âŒ å·¥ä½œç»Ÿè®¡ï¼ˆFocusæ—¶é•¿ã€ä»»åŠ¡å®Œæˆç‡ï¼‰
- âŒ é˜…è¯»ç»Ÿè®¡ï¼ˆé˜…è¯»æ—¶é•¿ã€ä¹¦ç±è¿›åº¦ï¼‰
- âŒ ç»¼åˆç»Ÿè®¡ï¼ˆå„ç»´åº¦å®Œæˆåº¦ã€ç»¼åˆè¯„åˆ†è¶‹åŠ¿ï¼‰
- âŒ AIæ€»ç»“ï¼ˆå‘¨/æœˆè¡¨ç°æ€»ç»“ä¸å»ºè®®ï¼‰

**éœ€è¦å®ç°ï¼š**
1. **åç«¯ç»Ÿè®¡APIï¼š**
   ```javascript
   GET /api/stats/summary?period=week&startDate=xxx
   è¿”å›ï¼š{
     exercise: { totalMinutes, avgPerDay, ... },
     diet: { totalCalories, avgPerDay, ... },
     sleep: { avgHours, qualityScore, ... },
     work: { totalFocusMinutes, completedSessions, ... },
     reading: { totalMinutes, booksRead, ... },
     aiSummary: "æœ¬å‘¨è¡¨ç°åˆ†æ..."
   }
   ```
2. **å‰ç«¯ç»Ÿè®¡é¡µé¢ï¼š**
   - å¤šç»´åº¦å›¾è¡¨ç»„ä»¶
   - æ•°æ®è¿‡æ»¤å™¨ï¼ˆå‘¨/æœˆ/è‡ªå®šä¹‰ï¼‰
   - AIæ€»ç»“å¡ç‰‡
3. **AIæ€»ç»“æœåŠ¡ï¼š**
   - å‘¨æœŸæ€§æ•°æ®èšåˆ
   - AIè¶‹åŠ¿åˆ†æ

**æ–‡ä»¶ä½ç½®ï¼š**
- å‰ç«¯ï¼š`lib/features/stats/presentation/stats_page.dart`
- å‰ç«¯ï¼š`lib/features/stats/application/stats_provider.dart` (éœ€æ‰©å±•)
- åç«¯ï¼šéœ€æ–°å¢ `server/src/routes/stats.js`

#### 4ï¸âƒ£ M7 - å¤ç›˜å†å²ï¼ˆå®Œæˆåº¦ï¼š60%ï¼‰
**å·²æœ‰åŠŸèƒ½ï¼š**
- âœ… å¤ç›˜åˆ—è¡¨å±•ç¤º
- âœ… å¤ç›˜è¯¦æƒ…æŸ¥çœ‹
- âœ… æŒ‰æ—¥æœŸæ’åº

**ç¼ºå¤±åŠŸèƒ½ï¼š**
- âŒ å¤ç›˜ç¼–è¾‘åŠŸèƒ½
- âŒ å¤ç›˜åˆ é™¤ç¡®è®¤
- âŒ æœç´¢/ç­›é€‰åŠŸèƒ½

**éœ€è¦å®ç°ï¼š**
- ç¼–è¾‘å¤ç›˜é¡µé¢
- åˆ é™¤ç¡®è®¤å¯¹è¯æ¡†
- å¯é€‰ï¼šæ ‡ç­¾/åˆ†ç±»åŠŸèƒ½

**æ–‡ä»¶ä½ç½®ï¼š**
- `lib/features/review/presentation/review_page.dart`

#### 5ï¸âƒ£ M8-ç›®æ ‡ - ç›®æ ‡ç®¡ç†ï¼ˆå®Œæˆåº¦ï¼š20%ï¼‰
**å·²æœ‰åŠŸèƒ½ï¼š**
- âœ… ProfileGoalæ•°æ®æ¨¡å‹
- âœ… åŸºç¡€CRUDæ–¹æ³•
- âœ… åç«¯å¯èƒ½æœ‰goalsè¡¨ï¼ˆå¾…ç¡®è®¤ï¼‰

**ç¼ºå¤±åŠŸèƒ½ï¼š**
- âŒ ç›®æ ‡ç®¡ç†UIé¡µé¢
- âŒ ç›®æ ‡ç±»å‹ï¼ˆå¥åº·/å·¥ä½œ/é˜…è¯»/è‡ªå®šä¹‰ï¼‰
- âŒ ç›®æ ‡è¿›åº¦è¿½è¸ª
- âŒ ç›®æ ‡å®Œæˆåº†ç¥åŠ¨æ•ˆ
- âŒ é¦–é¡µç›®æ ‡å±•ç¤º

**éœ€è¦å®ç°ï¼š**
1. **ç›®æ ‡ç®¡ç†é¡µé¢ï¼š**
   - ç›®æ ‡åˆ—è¡¨
   - æ·»åŠ /ç¼–è¾‘/åˆ é™¤ç›®æ ‡
   - ç›®æ ‡è¿›åº¦å¯è§†åŒ–
2. **ç›®æ ‡ç±»å‹ï¼š**
   - æ•°å€¼å‹ï¼ˆå¦‚"æ¯å‘¨è¿åŠ¨3æ¬¡"ï¼‰
   - æ—¶é•¿å‹ï¼ˆå¦‚"æ¯å¤©é˜…è¯»30åˆ†é’Ÿ"ï¼‰
   - ä¹ æƒ¯å‹ï¼ˆå¦‚"æ¯å¤©å¤ç›˜"ï¼‰
3. **ç›®æ ‡è¿½è¸ªï¼š**
   - è‡ªåŠ¨å…³è”å„ç»´åº¦æ•°æ®
   - è¿›åº¦è®¡ç®—
   - å®Œæˆæé†’

**æ–‡ä»¶ä½ç½®ï¼š**
- å‰ç«¯ï¼šéœ€æ–°å»º `lib/features/goals/`
- åç«¯ï¼šéœ€æ–°å»º `server/src/routes/goals.js`

#### 6ï¸âƒ£ AIé£Ÿç‰©è¯†åˆ«ï¼ˆå®Œæˆåº¦ï¼š20%ï¼‰
**å·²æœ‰åŠŸèƒ½ï¼š**
- âœ… AIè¯†åˆ«é¡µé¢UI
- âœ… ç›¸æœº/ç›¸å†Œè°ƒç”¨
- âœ… å›¾ç‰‡é¢„è§ˆ

**ç¼ºå¤±åŠŸèƒ½ï¼š**
- âŒ çœŸå®çš„AIè¯†åˆ«æ¥å£ï¼ˆå½“å‰æ˜¯hardcodedï¼‰
- âŒ åç«¯å›¾åƒè¯†åˆ«æœåŠ¡é›†æˆ
- âŒ è¯†åˆ«ç»“æœç¼–è¾‘ä¼˜åŒ–

**éœ€è¦å®ç°ï¼š**
1. **åç«¯AIæœåŠ¡ï¼š**
   - å›¾ç‰‡ä¸Šä¼ æ¥å£
   - è°ƒç”¨å›¾åƒè¯†åˆ«APIï¼ˆå¦‚ç™¾åº¦AIã€é˜¿é‡Œäº‘ã€æˆ–è‡ªå»ºæ¨¡å‹ï¼‰
   - è¿”å›è¯†åˆ«ç»“æœ
2. **å‰ç«¯ä¼˜åŒ–ï¼š**
   - åŠ è½½çŠ¶æ€å±•ç¤º
   - è¯†åˆ«å¤±è´¥é™çº§åˆ°æ‰‹åŠ¨è¾“å…¥
   - è¯†åˆ«ç»“æœäºŒæ¬¡ç¡®è®¤

**APIè®¾è®¡ï¼š**
```javascript
POST /api/meals/recognize-food
Body: { image: base64/url }
Response: {
  items: [
    { name: "ç±³é¥­", calories: 200, protein: 4, carbs: 45, fat: 0.5 },
    { name: "é¸¡èƒ¸è‚‰", calories: 165, protein: 31, carbs: 0, fat: 3.6 }
  ],
  confidence: 0.85
}
```

**æ–‡ä»¶ä½ç½®ï¼š**
- å‰ç«¯ï¼š`lib/features/diet/presentation/ai_food_recognition_page.dart`
- åç«¯ï¼šéœ€æ–°å¢ `server/src/routes/meals.js` ä¸­çš„AI endpoint

---

## å››ã€è¯¦ç»†å®ç°è®¡åˆ’

### Phase 1: æ ¸å¿ƒåŠŸèƒ½è¡¥å…¨ï¼ˆP0ä¼˜å…ˆçº§ï¼Œé¢„è®¡2-3å‘¨ï¼‰

#### ä»»åŠ¡1.1ï¼šå®ç°é˜…è¯»è®°å½•æ¨¡å— ğŸ¯
**ä¼˜å…ˆçº§ï¼š** P0
**é¢„è®¡å·¥æ—¶ï¼š** 3å¤©
**ä¾èµ–ï¼š** æ— 

**å‰ç«¯ä»»åŠ¡ï¼š**
1. åˆ›å»ºfeatureç›®å½•ç»“æ„
   ```
   lib/features/reading/
   â”œâ”€â”€ presentation/
   â”‚   â”œâ”€â”€ reading_page.dart
   â”‚   â”œâ”€â”€ add_reading_page.dart
   â”‚   â””â”€â”€ widgets/
   â”‚       â”œâ”€â”€ reading_card.dart
   â”‚       â””â”€â”€ reading_stats_widget.dart
   â”œâ”€â”€ application/
   â”‚   â””â”€â”€ reading_provider.dart
   â”œâ”€â”€ domain/
   â”‚   â””â”€â”€ reading_record.dart
   â””â”€â”€ data/
       â””â”€â”€ reading_repository.dart
   ```

2. æ•°æ®æ¨¡å‹å®šä¹‰ï¼ˆFreezedï¼‰ï¼š
   ```dart
   @freezed
   class ReadingRecord with _$ReadingRecord {
     factory ReadingRecord({
       required String id,
       required String userId,
       required String bookTitle,
       String? bookAuthor,
       required DateTime startTime,
       required int durationMinutes,
       int? pagesRead,
       String? notes,
       String? excerpt, // æ‘˜æŠ„
       String? aiSummary, // AIæ€»ç»“
     }) = _ReadingRecord;
   }
   ```

3. Repositoryå®ç°ï¼š
   - GET `/api/reading` - è·å–é˜…è¯»è®°å½•
   - POST `/api/reading` - åˆ›å»º/æ›´æ–°è®°å½•
   - DELETE `/api/reading/:id` - åˆ é™¤è®°å½•
   - æœ¬åœ°ç¼“å­˜é€»è¾‘

4. UIå®ç°ï¼š
   - é˜…è¯»è®°å½•åˆ—è¡¨é¡µ
   - æ·»åŠ é˜…è¯»è®°å½•è¡¨å•ï¼ˆä¹¦åã€ä½œè€…ã€æ—¶é•¿ã€é¡µæ•°ã€æ‘˜æŠ„ï¼‰
   - é˜…è¯»ç»Ÿè®¡å¡ç‰‡
   - Dashboardé›†æˆ

5. è·¯ç”±æ³¨å†Œï¼š
   ```dart
   GoRoute(
     path: '/reading',
     builder: (context, state) => const ReadingPage(),
   ),
   ```

**åç«¯ä»»åŠ¡ï¼š**
1. æ•°æ®åº“è¡¨è®¾è®¡ï¼š
   ```sql
   CREATE TABLE IF NOT EXISTS reading_records (
     id TEXT PRIMARY KEY,
     user_id TEXT NOT NULL,
     book_title TEXT NOT NULL,
     book_author TEXT,
     start_time TEXT NOT NULL,
     duration_minutes INTEGER NOT NULL,
     pages_read INTEGER,
     notes TEXT,
     excerpt TEXT,
     ai_summary TEXT,
     created_at TEXT DEFAULT CURRENT_TIMESTAMP,
     updated_at TEXT DEFAULT CURRENT_TIMESTAMP,
     FOREIGN KEY (user_id) REFERENCES users(id)
   );
   CREATE INDEX idx_reading_user_time ON reading_records(user_id, start_time);
   ```

2. APIè·¯ç”±å®ç°ï¼ˆ`server/src/routes/reading.js`ï¼‰ï¼š
   ```javascript
   const express = require('express');
   const { db } = require('../config/database');
   const authMiddleware = require('../middleware/auth');

   const router = express.Router();
   router.use(authMiddleware);

   // GET /api/reading - è·å–é˜…è¯»è®°å½•
   router.get('/', (req, res, next) => { /* ... */ });

   // POST /api/reading - åˆ›å»º/æ›´æ–°è®°å½•
   router.post('/', (req, res, next) => { /* ... */ });

   // DELETE /api/reading/:id - åˆ é™¤è®°å½•
   router.delete('/:id', (req, res, next) => { /* ... */ });

   module.exports = router;
   ```

3. åœ¨ `server/src/index.js` ä¸­æ³¨å†Œè·¯ç”±ï¼š
   ```javascript
   const readingRouter = require('./routes/reading');
   app.use('/api/reading', readingRouter);
   ```

**æµ‹è¯•éªŒæ”¶ï¼š**
- [ ] å¯ä»¥æ·»åŠ é˜…è¯»è®°å½•
- [ ] Dashboardæ˜¾ç¤ºé˜…è¯»æ•°æ®
- [ ] å¿«é€Ÿè®°å½•ä¸­readingå…¥å£å¯ç”¨
- [ ] é˜…è¯»è®°å½•åˆ—è¡¨æ­£ç¡®å±•ç¤º
- [ ] å¯ä»¥ç¼–è¾‘å’Œåˆ é™¤è®°å½•
- [ ] ç¦»çº¿æ—¶æœ¬åœ°ç¼“å­˜ç”Ÿæ•ˆ

---

#### ä»»åŠ¡1.2ï¼šå®ç°é€šçŸ¥ç³»ç»Ÿ ğŸ””
**ä¼˜å…ˆçº§ï¼š** P0
**é¢„è®¡å·¥æ—¶ï¼š** 4å¤©
**ä¾èµ–ï¼š** æ— 

**å‰ç«¯ä»»åŠ¡ï¼š**
1. å®‰è£…ä¾èµ–ï¼š
   ```yaml
   dependencies:
     flutter_local_notifications: ^17.0.0
     timezone: ^0.9.0
     permission_handler: ^11.0.0  # æƒé™ç®¡ç†
   ```

2. åˆ›å»ºé€šçŸ¥æœåŠ¡ï¼š
   ```dart
   // lib/shared/services/notification_service.dart
   class NotificationService {
     static final FlutterLocalNotificationsPlugin _plugin =
         FlutterLocalNotificationsPlugin();

     Future<void> initialize() async { /* ... */ }

     Future<void> requestPermissions() async { /* ... */ }

     Future<void> scheduleReviewReminder({
       required TimeOfDay time,
       required bool enabled,
     }) async { /* ... */ }

     Future<void> scheduleMorningPlanReminder({
       required TimeOfDay time,
       required bool enabled,
     }) async { /* ... */ }

     Future<void> cancelAllNotifications() async { /* ... */ }
   }
   ```

3. Provideré›†æˆï¼š
   ```dart
   final notificationServiceProvider = Provider<NotificationService>((ref) {
     return NotificationService();
   });
   ```

4. è®¾ç½®é¡µé¢é›†æˆï¼š
   - é€šçŸ¥æƒé™è¯·æ±‚æŒ‰é’®
   - å¤œé—´å¤ç›˜æé†’æ—¶é—´é€‰æ‹©å™¨
   - æ—©æ™¨è®¡åˆ’æé†’æ—¶é—´é€‰æ‹©å™¨
   - æé†’å¼€å…³ï¼ˆå·²æœ‰ï¼Œéœ€è¿æ¥åŠŸèƒ½ï¼‰

5. Appåˆå§‹åŒ–æ—¶è°ƒç”¨ï¼š
   ```dart
   // lib/app/bootstrap.dart
   final notificationService = ref.read(notificationServiceProvider);
   await notificationService.initialize();
   ```

**åç«¯ä»»åŠ¡ï¼š**
- åç«¯æš‚ä¸éœ€è¦ä¿®æ”¹ï¼ˆä½¿ç”¨æœ¬åœ°é€šçŸ¥ï¼‰
- å¯é€‰ï¼šå¦‚éœ€äº‘æ¨é€ï¼Œåˆ™éœ€é›†æˆFCM

**é«˜çº§åŠŸèƒ½ï¼ˆå¯é€‰ï¼‰ï¼š**
- Firebase Cloud Messagingé›†æˆ
- æ¨é€é€šçŸ¥ï¼ˆç”¨äºè·¨è®¾å¤‡åŒæ­¥æé†’ï¼‰
- é€šçŸ¥ç‚¹å‡»è·³è½¬åˆ°å¯¹åº”é¡µé¢

**æµ‹è¯•éªŒæ”¶ï¼š**
- [ ] ç”¨æˆ·é¦–æ¬¡æ‰“å¼€Appæ—¶è¯·æ±‚é€šçŸ¥æƒé™
- [ ] å¯ä»¥è®¾ç½®å¤œé—´å¤ç›˜æé†’æ—¶é—´
- [ ] åˆ°è¾¾è®¾å®šæ—¶é—´æ—¶æ”¶åˆ°æœ¬åœ°é€šçŸ¥
- [ ] ç‚¹å‡»é€šçŸ¥å¯è·³è½¬åˆ°å¤ç›˜é¡µé¢
- [ ] å¯ä»¥å…³é—­é€šçŸ¥
- [ ] å¯ä»¥è®¾ç½®æ—©æ™¨è®¡åˆ’æé†’

---

#### ä»»åŠ¡1.3ï¼šä¼˜åŒ–Dashboardå¿«é€Ÿè®°å½• âš¡
**ä¼˜å…ˆçº§ï¼š** P0
**é¢„è®¡å·¥æ—¶ï¼š** 1å¤©
**ä¾èµ–ï¼š** ä»»åŠ¡1.1ï¼ˆé˜…è¯»æ¨¡å—ï¼‰

**ä»»åŠ¡å†…å®¹ï¼š**
1. è¿æ¥Readingå¿«é€Ÿè®°å½•åˆ°å®é™…ä¿å­˜é€»è¾‘
2. ä¼˜åŒ–å¿«é€Ÿè®°å½•ä¿å­˜åçš„æ•°æ®åˆ·æ–°
3. ä¿®å¤Dashboardå¡ç‰‡æ•°æ®ä¸æ›´æ–°çš„é—®é¢˜

**ä»£ç ä½ç½®ï¼š**
- `lib/features/dashboard/presentation/widgets/quick_record_sheet.dart`
- `lib/features/dashboard/application/dashboard_providers.dart`

**å®ç°ç»†èŠ‚ï¼š**
```dart
// åœ¨QuickRecordSheetä¸­æ·»åŠ readingä¿å­˜é€»è¾‘
case RecordType.reading:
  final readingProvider = ref.read(readingNotifierProvider.notifier);
  await readingProvider.addReading(ReadingRecord(
    id: Uuid().v4(),
    userId: userId,
    bookTitle: bookTitle,
    startTime: DateTime.now(),
    durationMinutes: duration,
    notes: notes,
  ));

  // åˆ·æ–°Dashboardæ•°æ®
  ref.invalidate(dashboardOverviewProvider);
```

**æµ‹è¯•éªŒæ”¶ï¼š**
- [ ] æ‰€æœ‰5ç§ç±»å‹çš„å¿«é€Ÿè®°å½•éƒ½å¯ä¿å­˜
- [ ] ä¿å­˜åDashboardæ•°æ®ç«‹å³æ›´æ–°
- [ ] å¿«é€Ÿè®°å½•å¼¹çª—è‡ªåŠ¨å…³é—­
- [ ] æ˜¾ç¤ºä¿å­˜æˆåŠŸæç¤º

---

### Phase 2: AIåŠŸèƒ½é›†æˆï¼ˆP0-P1ï¼Œé¢„è®¡2-3å‘¨ï¼‰

#### ä»»åŠ¡2.1ï¼šé›†æˆAIæœåŠ¡åŸºç¡€è®¾æ–½ ğŸ¤–
**ä¼˜å…ˆçº§ï¼š** P0
**é¢„è®¡å·¥æ—¶ï¼š** 3å¤©
**ä¾èµ–ï¼š** æ— 

**é€‰æ‹©AIæœåŠ¡ï¼š**
- é€‰é¡¹1ï¼šOpenAI API (GPT-3.5/GPT-4)
- é€‰é¡¹2ï¼šå›½å†…å¤§æ¨¡å‹ï¼ˆæ–‡å¿ƒä¸€è¨€ã€é€šä¹‰åƒé—®ã€è®¯é£æ˜Ÿç«ï¼‰
- é€‰é¡¹3ï¼šå¼€æºæ¨¡å‹ï¼ˆLLaMAã€ChatGLMï¼‰
- æ¨èï¼šæ–‡å¿ƒä¸€è¨€æˆ–é€šä¹‰åƒé—®ï¼ˆå›½å†…è®¿é—®ç¨³å®šï¼Œä»·æ ¼åˆç†ï¼‰

**åç«¯ä»»åŠ¡ï¼š**
1. å®‰è£…AI SDKï¼š
   ```bash
   npm install openai  # æˆ–å…¶ä»–AIæœåŠ¡çš„SDK
   ```

2. ç¯å¢ƒå˜é‡é…ç½®ï¼ˆ`.env`ï¼‰ï¼š
   ```env
   AI_SERVICE_PROVIDER=openai  # æˆ– wenxin, tongyi
   AI_API_KEY=your_api_key_here
   AI_MODEL=gpt-3.5-turbo  # æˆ–å…¶ä»–æ¨¡å‹
   ```

3. åˆ›å»ºAIæœåŠ¡å°è£…ï¼ˆ`server/src/services/ai_service.js`ï¼‰ï¼š
   ```javascript
   const { Configuration, OpenAIApi } = require('openai');

   class AIService {
     constructor() {
       this.client = new OpenAIApi(new Configuration({
         apiKey: process.env.AI_API_KEY,
       }));
     }

     async generateReviewSummary(reviewData) {
       const prompt = this.buildReviewPrompt(reviewData);
       const response = await this.client.createChatCompletion({
         model: process.env.AI_MODEL,
         messages: [{ role: 'user', content: prompt }],
         temperature: 0.7,
       });
       return JSON.parse(response.data.choices[0].message.content);
     }

     async generateTomorrowPlan(userData) { /* ... */ }

     async generateWeeklySummary(statsData) { /* ... */ }

     buildReviewPrompt(data) {
       return `
         è¯·æ ¹æ®ä»¥ä¸‹ç”¨æˆ·ä»Šæ—¥æ•°æ®ç”Ÿæˆå¤ç›˜æŠ¥å‘Šï¼š
         - è¿åŠ¨ï¼š${data.exercise}
         - é¥®é£Ÿï¼š${data.diet}
         - ç¡çœ ï¼š${data.sleep}
         - å·¥ä½œï¼š${data.work}
         - é˜…è¯»ï¼š${data.reading}
         - ç”¨æˆ·å›ç­”ï¼š${data.userAnswers}

         è¯·ä»¥JSONæ ¼å¼è¿”å›ï¼š
         {
           "keywords": ["å…³é”®è¯1", "å…³é”®è¯2", "å…³é”®è¯3"],
           "highlights": ["äº®ç‚¹1", "äº®ç‚¹2"],
           "improvements": ["æ”¹è¿›ç‚¹1", "æ”¹è¿›ç‚¹2"],
           "suggestions": ["å»ºè®®1", "å»ºè®®2"],
           "overallScore": 85
         }
       `;
     }
   }

   module.exports = new AIService();
   ```

4. é”™è¯¯å¤„ç†ä¸é‡è¯•æœºåˆ¶ï¼š
   - APIè°ƒç”¨å¤±è´¥æ—¶çš„fallback
   - è¶…æ—¶å¤„ç†
   - æˆæœ¬æ§åˆ¶ï¼ˆé™æµï¼‰

**æµ‹è¯•éªŒæ”¶ï¼š**
- [ ] AIæœåŠ¡å¯ä»¥æˆåŠŸåˆå§‹åŒ–
- [ ] æµ‹è¯•æ¥å£å¯ä»¥æ­£å¸¸è°ƒç”¨
- [ ] é”™è¯¯æ—¶æœ‰åˆç†çš„é™çº§å¤„ç†
- [ ] æ—¥å¿—è®°å½•AIè°ƒç”¨æƒ…å†µ

---

#### ä»»åŠ¡2.2ï¼šå®ç°å¤œé—´å¤ç›˜AIåŠŸèƒ½ ğŸŒ™
**ä¼˜å…ˆçº§ï¼š** P0
**é¢„è®¡å·¥æ—¶ï¼š** 5å¤©
**ä¾èµ–ï¼š** ä»»åŠ¡2.1ï¼ˆAIæœåŠ¡ï¼‰

**åç«¯ä»»åŠ¡ï¼š**
1. æ–°å¢AIå¤ç›˜æ¥å£ï¼ˆ`server/src/routes/reviews.js`ï¼‰ï¼š
   ```javascript
   // POST /api/reviews/generate-summary
   router.post('/generate-summary', async (req, res, next) => {
     try {
       const { date, userAnswers } = req.body;
       const userId = req.userId;

       // 1. è·å–å½“æ—¥å„ç»´åº¦æ•°æ®
       const exerciseData = getExerciseData(userId, date);
       const dietData = getDietData(userId, date);
       const sleepData = getSleepData(userId, date);
       const workData = getWorkData(userId, date);
       const readingData = getReadingData(userId, date);

       // 2. è·å–ç”¨æˆ·ç›®æ ‡
       const userGoals = getUserGoals(userId);

       // 3. æ„å»ºå¤ç›˜æ•°æ®
       const reviewData = {
         exercise: exerciseData,
         diet: dietData,
         sleep: sleepData,
         work: workData,
         reading: readingData,
         userAnswers: userAnswers,
         goals: userGoals,
       };

       // 4. è°ƒç”¨AIæœåŠ¡ç”Ÿæˆå¤ç›˜
       const aiSummary = await aiService.generateReviewSummary(reviewData);

       res.json(aiSummary);
     } catch (error) {
       next(error);
     }
   });
   ```

2. è¾…åŠ©å‡½æ•°å®ç°ï¼š
   ```javascript
   function getExerciseData(userId, date) {
     const stmt = db.prepare(`
       SELECT type, duration_minutes, distance_km, calories_kcal
       FROM workout_records
       WHERE user_id = ? AND DATE(start_time) = ?
     `);
     return stmt.all(userId, date);
   }
   // ... å…¶ä»–ç»´åº¦ç±»ä¼¼
   ```

**å‰ç«¯ä»»åŠ¡ï¼š**
1. é‡æ„å¤œé—´å¤ç›˜é¡µé¢ï¼ˆ`lib/features/review/presentation/night_review_page.dart`ï¼‰ï¼š
   ```dart
   class NightReviewPage extends ConsumerStatefulWidget {
     // é¡µé¢ç»“æ„ï¼š
     // 1. ä»Šæ—¥æ•°æ®æ¦‚è§ˆå¡ç‰‡ï¼ˆå„ç»´åº¦æ±‡æ€»ï¼‰
     // 2. å¼•å¯¼å¼æé—®ï¼ˆ3-5ä¸ªé—®é¢˜ï¼‰
     // 3. AIç”Ÿæˆå¤ç›˜æŠ¥å‘ŠåŒºåŸŸ
     // 4. ä¿å­˜/ç¼–è¾‘æŒ‰é’®
   }
   ```

2. ä»Šæ—¥æ¦‚è§ˆç»„ä»¶ï¼š
   ```dart
   class TodayOverviewCard extends ConsumerWidget {
     Widget build(context, ref) {
       final exercise = ref.watch(exerciseTodayProvider);
       final diet = ref.watch(dietTodayProvider);
       final sleep = ref.watch(sleepTodayProvider);
       final work = ref.watch(workTodayProvider);
       final reading = ref.watch(readingTodayProvider);

       return Card(
         child: Column(
           children: [
             OverviewItem(icon: Icons.run, label: 'è¿åŠ¨', value: exercise),
             OverviewItem(icon: Icons.restaurant, label: 'é¥®é£Ÿ', value: diet),
             // ... å…¶ä»–ç»´åº¦
           ],
         ),
       );
     }
   }
   ```

3. å¼•å¯¼å¼æé—®ç»„ä»¶ï¼š
   ```dart
   class ReviewQuestionsWidget extends StatefulWidget {
     final List<ReviewQuestion> questions = [
       ReviewQuestion(
         id: '1',
         text: 'ä»Šå¤©æœ€è®©ä½ æ»¡æ„çš„äº‹æƒ…æ˜¯ä»€ä¹ˆï¼Ÿ',
         type: QuestionType.text,
       ),
       ReviewQuestion(
         id: '2',
         text: 'ä»Šå¤©çš„æƒ…ç»ªçŠ¶æ€å¦‚ä½•ï¼Ÿ',
         type: QuestionType.scale,  // 1-5åˆ†
       ),
       ReviewQuestion(
         id: '3',
         text: 'ä»Šå¤©é‡åˆ°çš„æœ€å¤§æŒ‘æˆ˜æ˜¯ä»€ä¹ˆï¼Ÿ',
         type: QuestionType.text,
       ),
       ReviewQuestion(
         id: '4',
         text: 'æ˜å¤©æœ€æƒ³å®Œæˆçš„ä¸‰ä»¶äº‹ï¼Ÿ',
         type: QuestionType.list,  // å¤šè¡Œè¾“å…¥
       ),
     ];

     // ç”¨æˆ·å›ç­”å­˜å‚¨
     Map<String, dynamic> answers = {};
   }
   ```

4. AIå¤ç›˜æŠ¥å‘Šç»„ä»¶ï¼š
   ```dart
   class AIReviewReport extends StatelessWidget {
     final AIReviewSummary summary;

     Widget build(context) {
       return Card(
         child: Column(
           children: [
             // å…³é”®è¯æ ‡ç­¾
             Wrap(
               children: summary.keywords.map((k) => Chip(label: Text(k))).toList(),
             ),

             // äº®ç‚¹
             SectionHeader(title: 'ä»Šæ—¥äº®ç‚¹ âœ¨'),
             ...summary.highlights.map((h) => ListTile(title: Text(h))),

             // æ”¹è¿›ç‚¹
             SectionHeader(title: 'å¯ä»¥æ”¹è¿› ğŸ’¡'),
             ...summary.improvements.map((i) => ListTile(title: Text(i))),

             // æ˜æ—¥å»ºè®®
             SectionHeader(title: 'æ˜æ—¥å»ºè®® ğŸ¯'),
             ...summary.suggestions.map((s) => ListTile(title: Text(s))),

             // ç»¼åˆè¯„åˆ†
             ScoreGauge(score: summary.overallScore),
           ],
         ),
       );
     }
   }
   ```

5. çŠ¶æ€ç®¡ç†ï¼ˆ`lib/features/review/application/night_review_provider.dart`ï¼‰ï¼š
   ```dart
   @riverpod
   class NightReviewNotifier extends _$NightReviewNotifier {
     @override
     AsyncValue<AIReviewSummary?> build() {
       return const AsyncValue.data(null);
     }

     Future<void> generateSummary(Map<String, dynamic> userAnswers) async {
       state = const AsyncValue.loading();

       try {
         final date = DateTime.now().toIso8601String().split('T')[0];
         final response = await ref.read(apiClientProvider).post(
           '/api/reviews/generate-summary',
           data: {
             'date': date,
             'userAnswers': userAnswers,
           },
         );

         final summary = AIReviewSummary.fromJson(response.data);
         state = AsyncValue.data(summary);
       } catch (e, st) {
         state = AsyncValue.error(e, st);
       }
     }

     Future<void> saveSummary(AIReviewSummary summary) async {
       // ä¿å­˜åˆ°review_entriesè¡¨
     }
   }
   ```

**äº¤äº’æµç¨‹ï¼š**
1. ç”¨æˆ·ç‚¹å‡»"å¼€å§‹å¤ç›˜" â†’ è¿›å…¥å¤œé—´å¤ç›˜é¡µé¢
2. å±•ç¤ºä»Šæ—¥æ•°æ®æ¦‚è§ˆï¼ˆè‡ªåŠ¨æ‹‰å–ï¼‰
3. ç”¨æˆ·ä¾æ¬¡å›ç­”3-5ä¸ªé—®é¢˜
4. ç”¨æˆ·ç‚¹å‡»"ç”Ÿæˆå¤ç›˜æŠ¥å‘Š" â†’ æ˜¾ç¤ºåŠ è½½åŠ¨ç”»ï¼ˆ3-8ç§’ï¼‰
5. AIç”Ÿæˆå®Œæ¯• â†’ å±•ç¤ºç»“æ„åŒ–æŠ¥å‘Š
6. ç”¨æˆ·å¯ç¼–è¾‘éƒ¨åˆ†å†…å®¹ â†’ ç‚¹å‡»"ä¿å­˜"
7. ä¿å­˜æˆåŠŸ â†’ è·³è½¬åˆ°å¤ç›˜è¯¦æƒ…é¡µæˆ–Dashboard

**é”™è¯¯å¤„ç†ï¼š**
- AIç”Ÿæˆå¤±è´¥ â†’ æ˜¾ç¤º"é‡è¯•"æŒ‰é’®å’Œ"ä»…ä¿å­˜æˆ‘çš„å›ç­”"é€‰é¡¹
- ç½‘ç»œå¼‚å¸¸ â†’ æœ¬åœ°ç¼“å­˜ç”¨æˆ·å›ç­”ï¼Œå¾…ç½‘ç»œæ¢å¤åé‡è¯•
- è¶…æ—¶ â†’ æç¤º"AIæ­£åœ¨æ€è€ƒï¼Œè¯·ç¨å€™"

**æµ‹è¯•éªŒæ”¶ï¼š**
- [ ] ä»Šæ—¥æ¦‚è§ˆæ­£ç¡®å±•ç¤ºå„ç»´åº¦æ•°æ®
- [ ] å¯ä»¥å®Œæ•´å›ç­”æ‰€æœ‰é—®é¢˜
- [ ] AIå¯ä»¥æˆåŠŸç”Ÿæˆå¤ç›˜æŠ¥å‘Š
- [ ] æŠ¥å‘Šå†…å®¹ä¸å½“æ—¥æ•°æ®ç›¸å…³
- [ ] AIå¤±è´¥æ—¶å¯ä»¥é™çº§ä¿å­˜
- [ ] å¯ä»¥ç¼–è¾‘AIç”Ÿæˆçš„å†…å®¹
- [ ] å¤ç›˜è®°å½•æ­£ç¡®ä¿å­˜åˆ°æ•°æ®åº“

---

#### ä»»åŠ¡2.3ï¼šå®ç°AIé£Ÿç‰©è¯†åˆ« ğŸ“¸
**ä¼˜å…ˆçº§ï¼š** P1
**é¢„è®¡å·¥æ—¶ï¼š** 4å¤©
**ä¾èµ–ï¼š** ä»»åŠ¡2.1ï¼ˆAIæœåŠ¡ï¼‰

**é€‰æ‹©å›¾åƒè¯†åˆ«æ–¹æ¡ˆï¼š**
- é€‰é¡¹1ï¼šç™¾åº¦AIå¼€æ”¾å¹³å° - èœå“è¯†åˆ«API
- é€‰é¡¹2ï¼šé˜¿é‡Œäº‘è§†è§‰æ™ºèƒ½å¼€æ”¾å¹³å°
- é€‰é¡¹3ï¼šè…¾è®¯äº‘å›¾åƒåˆ†æ
- æ¨èï¼šç™¾åº¦AIï¼ˆè¯†åˆ«å‡†ç¡®åº¦é«˜ï¼Œæœ‰è¥å…»æˆåˆ†æ•°æ®ï¼‰

**åç«¯ä»»åŠ¡ï¼š**
1. é›†æˆå›¾åƒè¯†åˆ«SDKï¼š
   ```bash
   npm install @baiducloud/sdk  # ç™¾åº¦AI SDK
   ```

2. é…ç½®ç¯å¢ƒå˜é‡ï¼š
   ```env
   BAIDU_AI_APP_ID=your_app_id
   BAIDU_AI_API_KEY=your_api_key
   BAIDU_AI_SECRET_KEY=your_secret_key
   ```

3. åˆ›å»ºé£Ÿç‰©è¯†åˆ«æœåŠ¡ï¼ˆ`server/src/services/food_recognition_service.js`ï¼‰ï¼š
   ```javascript
   const AipImageClassifyClient = require('@baiducloud/sdk').imageClassify;

   class FoodRecognitionService {
     constructor() {
       this.client = new AipImageClassifyClient(
         process.env.BAIDU_AI_APP_ID,
         process.env.BAIDU_AI_API_KEY,
         process.env.BAIDU_AI_SECRET_KEY
       );
     }

     async recognizeFood(imageBase64) {
       try {
         // è°ƒç”¨ç™¾åº¦èœå“è¯†åˆ«API
         const result = await this.client.dishDetect(imageBase64);

         // è§£æè¯†åˆ«ç»“æœ
         const foods = result.result.map(item => ({
           name: item.name,
           probability: item.probability,
           calories: item.calorie || this.estimateCalories(item.name),
           // å¦‚æœAPIè¿”å›è¥å…»æˆåˆ†ï¼Œç›´æ¥ä½¿ç”¨ï¼Œå¦åˆ™æŸ¥è¯¢è¥å…»æ•°æ®åº“
           protein: item.protein || this.getNutrition(item.name).protein,
           carbs: item.carbs || this.getNutrition(item.name).carbs,
           fat: item.fat || this.getNutrition(item.name).fat,
         }));

         return {
           success: true,
           items: foods,
           confidence: result.result[0]?.probability || 0,
         };
       } catch (error) {
         console.error('Food recognition error:', error);
         return {
           success: false,
           error: 'è¯†åˆ«å¤±è´¥ï¼Œè¯·é‡è¯•æˆ–æ‰‹åŠ¨è¾“å…¥',
         };
       }
     }

     // å¤‡ç”¨ï¼šä»è¥å…»æ•°æ®åº“æŸ¥è¯¢
     getNutrition(foodName) {
       // å¯ä»¥é›†æˆç¬¬ä¸‰æ–¹è¥å…»æ•°æ®åº“APIï¼Œæˆ–ä½¿ç”¨æœ¬åœ°æ•°æ®åº“
       // å¦‚ï¼šUSDA FoodData Central, æˆ–è‡ªå»ºè¥å…»è¡¨
     }

     estimateCalories(foodName) {
       // ç®€å•ä¼°ç®—é€»è¾‘ï¼ˆç”Ÿäº§ç¯å¢ƒåº”ä½¿ç”¨çœŸå®æ•°æ®ï¼‰
       const calorieMap = {
         'ç±³é¥­': 130,
         'é¢æ¡': 140,
         'é¸¡èƒ¸è‚‰': 165,
         'é¸¡è›‹': 155,
         // ... æ›´å¤šé£Ÿç‰©
       };
       return calorieMap[foodName] || 100;
     }
   }

   module.exports = new FoodRecognitionService();
   ```

4. APIè·¯ç”±ï¼ˆ`server/src/routes/meals.js` ä¸­æ–°å¢ï¼‰ï¼š
   ```javascript
   const foodRecognitionService = require('../services/food_recognition_service');
   const multer = require('multer');
   const upload = multer({ storage: multer.memoryStorage() });

   // POST /api/meals/recognize
   router.post('/recognize', upload.single('image'), async (req, res, next) => {
     try {
       if (!req.file) {
         return res.status(400).json({ error: 'No image provided' });
       }

       // å°†å›¾ç‰‡è½¬ä¸ºbase64
       const imageBase64 = req.file.buffer.toString('base64');

       // è°ƒç”¨è¯†åˆ«æœåŠ¡
       const result = await foodRecognitionService.recognizeFood(imageBase64);

       res.json(result);
     } catch (error) {
       next(error);
     }
   });
   ```

**å‰ç«¯ä»»åŠ¡ï¼š**
1. ä¼˜åŒ–AIé£Ÿç‰©è¯†åˆ«é¡µé¢ï¼ˆ`lib/features/diet/presentation/ai_food_recognition_page.dart`ï¼‰ï¼š
   ```dart
   class AIFoodRecognitionPage extends ConsumerStatefulWidget {
     @override
     ConsumerState<AIFoodRecognitionPage> createState() => _AIFoodRecognitionPageState();
   }

   class _AIFoodRecognitionPageState extends ConsumerState<AIFoodRecognitionPage> {
     File? _imageFile;
     bool _isRecognizing = false;
     List<FoodItem>? _recognizedFoods;

     Future<void> _takePicture() async {
       final picker = ImagePicker();
       final XFile? photo = await picker.pickImage(source: ImageSource.camera);
       if (photo != null) {
         setState(() => _imageFile = File(photo.path));
         _recognizeFood();
       }
     }

     Future<void> _recognizeFood() async {
       if (_imageFile == null) return;

       setState(() => _isRecognizing = true);

       try {
         // ä¸Šä¼ å›¾ç‰‡åˆ°åç«¯
         final bytes = await _imageFile!.readAsBytes();
         final dio = ref.read(apiClientProvider);

         final formData = FormData.fromMap({
           'image': MultipartFile.fromBytes(bytes, filename: 'food.jpg'),
         });

         final response = await dio.post('/api/meals/recognize', data: formData);

         if (response.data['success']) {
           setState(() {
             _recognizedFoods = (response.data['items'] as List)
                 .map((item) => FoodItem.fromJson(item))
                 .toList();
           });
         } else {
           _showError(response.data['error']);
         }
       } catch (e) {
         _showError('è¯†åˆ«å¤±è´¥ï¼Œè¯·é‡è¯•æˆ–æ‰‹åŠ¨è¾“å…¥');
       } finally {
         setState(() => _isRecognizing = false);
       }
     }

     Widget build(BuildContext context) {
       return Scaffold(
         appBar: AppBar(title: Text('AI é£Ÿç‰©è¯†åˆ«')),
         body: Column(
           children: [
             // å›¾ç‰‡é¢„è§ˆ
             if (_imageFile != null)
               Image.file(_imageFile!, height: 300, fit: BoxFit.cover),

             // è¯†åˆ«ä¸­åŠ è½½åŠ¨ç”»
             if (_isRecognizing)
               CircularProgressIndicator(),

             // è¯†åˆ«ç»“æœ
             if (_recognizedFoods != null)
               Expanded(
                 child: ListView.builder(
                   itemCount: _recognizedFoods!.length,
                   itemBuilder: (context, index) {
                     final food = _recognizedFoods![index];
                     return FoodItemCard(
                       food: food,
                       onEdit: () => _editFood(index),
                       onDelete: () => _deleteFood(index),
                     );
                   },
                 ),
               ),

             // æ“ä½œæŒ‰é’®
             Row(
               children: [
                 ElevatedButton(
                   onPressed: _takePicture,
                   child: Text('é‡æ–°æ‹ç…§'),
                 ),
                 ElevatedButton(
                   onPressed: _manualInput,
                   child: Text('æ‰‹åŠ¨è¾“å…¥'),
                 ),
                 ElevatedButton(
                   onPressed: _saveMeal,
                   child: Text('ä¿å­˜'),
                 ),
               ],
             ),
           ],
         ),
       );
     }
   }
   ```

2. é£Ÿç‰©é¡¹ç¼–è¾‘ç»„ä»¶ï¼š
   ```dart
   class FoodItemCard extends StatelessWidget {
     final FoodItem food;
     final VoidCallback onEdit;
     final VoidCallback onDelete;

     Widget build(BuildContext context) {
       return Card(
         child: ListTile(
           leading: Icon(Icons.restaurant),
           title: Text(food.name),
           subtitle: Text('${food.calories} kcal | P:${food.protein}g C:${food.carbs}g F:${food.fat}g'),
           trailing: Row(
             mainAxisSize: MainAxisSize.min,
             children: [
               IconButton(icon: Icon(Icons.edit), onPressed: onEdit),
               IconButton(icon: Icon(Icons.delete), onPressed: onDelete),
             ],
           ),
         ),
       );
     }
   }
   ```

**æµ‹è¯•éªŒæ”¶ï¼š**
- [ ] å¯ä»¥æ‹ç…§æˆ–é€‰æ‹©ç›¸å†Œå›¾ç‰‡
- [ ] å›¾ç‰‡ä¸Šä¼ æˆåŠŸ
- [ ] AIè¯†åˆ«è¿”å›é£Ÿç‰©åˆ—è¡¨
- [ ] å¯ä»¥ç¼–è¾‘è¯†åˆ«ç»“æœï¼ˆä¿®æ”¹åç§°ã€è¥å…»æˆåˆ†ï¼‰
- [ ] å¯ä»¥åˆ é™¤é”™è¯¯è¯†åˆ«çš„é¡¹
- [ ] å¯ä»¥æ‰‹åŠ¨æ·»åŠ æœªè¯†åˆ«çš„é£Ÿç‰©
- [ ] è¯†åˆ«å¤±è´¥æ—¶å¯é™çº§åˆ°æ‰‹åŠ¨è¾“å…¥
- [ ] ä¿å­˜åè®°å½•æ­£ç¡®å†™å…¥æ•°æ®åº“

---

### Phase 3: ç»Ÿè®¡ä¸åˆ†æåŠŸèƒ½ï¼ˆP0-P1ï¼Œé¢„è®¡2å‘¨ï¼‰

#### ä»»åŠ¡3.1ï¼šå®ç°ç»¼åˆç»Ÿè®¡æ¨¡å— ğŸ“Š
**ä¼˜å…ˆçº§ï¼š** P0
**é¢„è®¡å·¥æ—¶ï¼š** 5å¤©
**ä¾èµ–ï¼š** ä»»åŠ¡1.1ï¼ˆé˜…è¯»æ¨¡å—ï¼‰

**åç«¯ä»»åŠ¡ï¼š**
1. åˆ›å»ºç»Ÿè®¡APIï¼ˆ`server/src/routes/stats.js`ï¼‰ï¼š
   ```javascript
   const express = require('express');
   const { db } = require('../config/database');
   const authMiddleware = require('../middleware/auth');
   const aiService = require('../services/ai_service');

   const router = express.Router();
   router.use(authMiddleware);

   // GET /api/stats/summary?period=week&startDate=2025-11-28
   router.get('/summary', async (req, res, next) => {
     try {
       const { period = 'week', startDate } = req.query;
       const userId = req.userId;

       const start = startDate || getStartDate(period);
       const end = new Date().toISOString().split('T')[0];

       // 1. èšåˆå„ç»´åº¦æ•°æ®
       const exerciseStats = getExerciseStats(userId, start, end);
       const dietStats = getDietStats(userId, start, end);
       const sleepStats = getSleepStats(userId, start, end);
       const workStats = getWorkStats(userId, start, end);
       const readingStats = getReadingStats(userId, start, end);

       // 2. è®¡ç®—ç»¼åˆæŒ‡æ ‡
       const overallScore = calculateOverallScore({
         exercise: exerciseStats,
         diet: dietStats,
         sleep: sleepStats,
         work: workStats,
         reading: readingStats,
       });

       // 3. è°ƒç”¨AIç”Ÿæˆå‘¨æœŸæ€»ç»“ï¼ˆå¯é€‰ï¼Œå¯ç¼“å­˜ï¼‰
       const aiSummary = await aiService.generateWeeklySummary({
         period,
         exercise: exerciseStats,
         diet: dietStats,
         sleep: sleepStats,
         work: workStats,
         reading: readingStats,
       });

       res.json({
         period,
         startDate: start,
         endDate: end,
         exercise: exerciseStats,
         diet: dietStats,
         sleep: sleepStats,
         work: workStats,
         reading: readingStats,
         overallScore,
         aiSummary,
       });
     } catch (error) {
       next(error);
     }
   });

   // è¾…åŠ©å‡½æ•°
   function getExerciseStats(userId, startDate, endDate) {
     const stmt = db.prepare(`
       SELECT
         COUNT(*) as totalSessions,
         SUM(duration_minutes) as totalMinutes,
         AVG(duration_minutes) as avgMinutesPerSession,
         SUM(distance_km) as totalDistance,
         SUM(calories_kcal) as totalCalories
       FROM workout_records
       WHERE user_id = ? AND DATE(start_time) BETWEEN ? AND ?
     `);
     const result = stmt.get(userId, startDate, endDate);

     // æŒ‰å¤©åˆ†ç»„
     const dailyStmt = db.prepare(`
       SELECT
         DATE(start_time) as date,
         SUM(duration_minutes) as minutes,
         SUM(calories_kcal) as calories
       FROM workout_records
       WHERE user_id = ? AND DATE(start_time) BETWEEN ? AND ?
       GROUP BY DATE(start_time)
       ORDER BY date
     `);
     const dailyData = dailyStmt.all(userId, startDate, endDate);

     return {
       ...result,
       dailyData,
       avgMinutesPerDay: result.totalMinutes / getDayCount(startDate, endDate),
     };
   }

   function getDietStats(userId, startDate, endDate) {
     const stmt = db.prepare(`
       SELECT
         COUNT(DISTINCT mr.id) as totalMeals,
         SUM(fi.calories) as totalCalories,
         SUM(fi.protein) as totalProtein,
         SUM(fi.carbs) as totalCarbs,
         SUM(fi.fat) as totalFat
       FROM meal_records mr
       LEFT JOIN food_items fi ON mr.id = fi.meal_id
       WHERE mr.user_id = ? AND DATE(mr.timestamp) BETWEEN ? AND ?
     `);
     const result = stmt.get(userId, startDate, endDate);

     // æŒ‰å¤©åˆ†ç»„
     const dailyStmt = db.prepare(`
       SELECT
         DATE(mr.timestamp) as date,
         SUM(fi.calories) as calories,
         SUM(fi.protein) as protein
       FROM meal_records mr
       LEFT JOIN food_items fi ON mr.id = fi.meal_id
       WHERE mr.user_id = ? AND DATE(mr.timestamp) BETWEEN ? AND ?
       GROUP BY DATE(mr.timestamp)
       ORDER BY date
     `);
     const dailyData = dailyStmt.all(userId, startDate, endDate);

     const dayCount = getDayCount(startDate, endDate);
     return {
       ...result,
       dailyData,
       avgCaloriesPerDay: result.totalCalories / dayCount,
       avgProteinPerDay: result.totalProtein / dayCount,
     };
   }

   function getSleepStats(userId, startDate, endDate) {
     const stmt = db.prepare(`
       SELECT
         COUNT(*) as totalRecords,
         AVG(
           (julianday(wake_time) - julianday(bedtime)) * 24
         ) as avgHours,
         AVG(quality) as avgQuality
       FROM sleep_records
       WHERE user_id = ? AND DATE(bedtime) BETWEEN ? AND ?
     `);
     const result = stmt.get(userId, startDate, endDate);

     // æŒ‰å¤©åˆ†ç»„
     const dailyStmt = db.prepare(`
       SELECT
         DATE(bedtime) as date,
         (julianday(wake_time) - julianday(bedtime)) * 24 as hours,
         quality
       FROM sleep_records
       WHERE user_id = ? AND DATE(bedtime) BETWEEN ? AND ?
       ORDER BY date
     `);
     const dailyData = dailyStmt.all(userId, startDate, endDate);

     return { ...result, dailyData };
   }

   function getWorkStats(userId, startDate, endDate) {
     const stmt = db.prepare(`
       SELECT
         COUNT(*) as totalSessions,
         SUM(duration_minutes) as totalMinutes,
         SUM(CASE WHEN completed = 1 THEN 1 ELSE 0 END) as completedSessions
       FROM focus_sessions
       WHERE user_id = ? AND DATE(start_time) BETWEEN ? AND ?
     `);
     const result = stmt.get(userId, startDate, endDate);

     // æŒ‰å¤©åˆ†ç»„
     const dailyStmt = db.prepare(`
       SELECT
         DATE(start_time) as date,
         SUM(duration_minutes) as minutes,
         COUNT(*) as sessions
       FROM focus_sessions
       WHERE user_id = ? AND DATE(start_time) BETWEEN ? AND ?
       GROUP BY DATE(start_time)
       ORDER BY date
     `);
     const dailyData = dailyStmt.all(userId, startDate, endDate);

     return {
       ...result,
       dailyData,
       completionRate: result.completedSessions / result.totalSessions,
       avgMinutesPerDay: result.totalMinutes / getDayCount(startDate, endDate),
     };
   }

   function getReadingStats(userId, startDate, endDate) {
     const stmt = db.prepare(`
       SELECT
         COUNT(*) as totalSessions,
         SUM(duration_minutes) as totalMinutes,
         SUM(pages_read) as totalPages,
         COUNT(DISTINCT book_title) as booksRead
       FROM reading_records
       WHERE user_id = ? AND DATE(start_time) BETWEEN ? AND ?
     `);
     const result = stmt.get(userId, startDate, endDate);

     // æŒ‰å¤©åˆ†ç»„
     const dailyStmt = db.prepare(`
       SELECT
         DATE(start_time) as date,
         SUM(duration_minutes) as minutes,
         SUM(pages_read) as pages
       FROM reading_records
       WHERE user_id = ? AND DATE(start_time) BETWEEN ? AND ?
       GROUP BY DATE(start_time)
       ORDER BY date
     `);
     const dailyData = dailyStmt.all(userId, startDate, endDate);

     return {
       ...result,
       dailyData,
       avgMinutesPerDay: result.totalMinutes / getDayCount(startDate, endDate),
     };
   }

   function calculateOverallScore(stats) {
     // ç»¼åˆè¯„åˆ†ç®—æ³•ï¼ˆå¯æ ¹æ®å®é™…éœ€æ±‚è°ƒæ•´æƒé‡ï¼‰
     const exerciseScore = Math.min((stats.exercise.avgMinutesPerDay / 30) * 20, 20);
     const dietScore = Math.min((2000 / Math.abs(stats.diet.avgCaloriesPerDay - 2000)) * 20, 20);
     const sleepScore = Math.min((stats.sleep.avgHours / 8) * 20, 20);
     const workScore = Math.min((stats.work.avgMinutesPerDay / 120) * 20, 20);
     const readingScore = Math.min((stats.reading.avgMinutesPerDay / 30) * 20, 20);

     return Math.round(exerciseScore + dietScore + sleepScore + workScore + readingScore);
   }

   function getStartDate(period) {
     const now = new Date();
     if (period === 'week') {
       now.setDate(now.getDate() - 7);
     } else if (period === 'month') {
       now.setMonth(now.getMonth() - 1);
     }
     return now.toISOString().split('T')[0];
   }

   function getDayCount(startDate, endDate) {
     const start = new Date(startDate);
     const end = new Date(endDate);
     return Math.ceil((end - start) / (1000 * 60 * 60 * 24)) + 1;
   }

   module.exports = router;
   ```

2. æ³¨å†Œè·¯ç”±ï¼ˆ`server/src/index.js`ï¼‰ï¼š
   ```javascript
   const statsRouter = require('./routes/stats');
   app.use('/api/stats', statsRouter);
   ```

**å‰ç«¯ä»»åŠ¡ï¼š**
1. é‡æ„ç»Ÿè®¡é¡µé¢ï¼ˆ`lib/features/stats/presentation/stats_page.dart`ï¼‰ï¼š
   ```dart
   class StatsPage extends ConsumerStatefulWidget {
     @override
     ConsumerState<StatsPage> createState() => _StatsPageState();
   }

   class _StatsPageState extends ConsumerState<StatsPage> {
     StatsPeriod _period = StatsPeriod.week;

     @override
     Widget build(BuildContext context) {
       final statsAsync = ref.watch(statsProvider(_period));

       return Scaffold(
         appBar: AppBar(
           title: Text('ç»Ÿè®¡æ€»è§ˆ'),
           actions: [
             // å‘¨æœŸåˆ‡æ¢æŒ‰é’®
             SegmentedButton<StatsPeriod>(
               segments: [
                 ButtonSegment(value: StatsPeriod.week, label: Text('å‘¨')),
                 ButtonSegment(value: StatsPeriod.month, label: Text('æœˆ')),
               ],
               selected: {_period},
               onSelectionChanged: (Set<StatsPeriod> newSelection) {
                 setState(() => _period = newSelection.first);
               },
             ),
           ],
         ),
         body: statsAsync.when(
           data: (stats) => _buildStatsContent(stats),
           loading: () => Center(child: CircularProgressIndicator()),
           error: (error, _) => Center(child: Text('åŠ è½½å¤±è´¥: $error')),
         ),
       );
     }

     Widget _buildStatsContent(StatsData stats) {
       return ListView(
         padding: EdgeInsets.all(16),
         children: [
           // ç»¼åˆè¯„åˆ†å¡ç‰‡
           OverallScoreCard(score: stats.overallScore),

           // AIæ€»ç»“å¡ç‰‡
           AISummaryCard(summary: stats.aiSummary),

           // å„ç»´åº¦ç»Ÿè®¡å›¾è¡¨
           ExerciseStatsCard(data: stats.exercise),
           DietStatsCard(data: stats.diet),
           SleepStatsCard(data: stats.sleep),
           WorkStatsCard(data: stats.work),
           ReadingStatsCard(data: stats.reading),
         ],
       );
     }
   }
   ```

2. åˆ›å»ºç»Ÿè®¡Providerï¼ˆ`lib/features/stats/application/stats_provider.dart`ï¼‰ï¼š
   ```dart
   @riverpod
   Future<StatsData> stats(StatsRef ref, StatsPeriod period) async {
     final apiClient = ref.watch(apiClientProvider);

     final response = await apiClient.get(
       '/api/stats/summary',
       queryParameters: {
         'period': period.name,
       },
     );

     return StatsData.fromJson(response.data);
   }
   ```

3. åˆ›å»ºæ•°æ®æ¨¡å‹ï¼ˆ`lib/features/stats/domain/stats_models.dart`ï¼‰ï¼š
   ```dart
   @freezed
   class StatsData with _$StatsData {
     factory StatsData({
       required String period,
       required String startDate,
       required String endDate,
       required ExerciseStats exercise,
       required DietStats diet,
       required SleepStats sleep,
       required WorkStats work,
       required ReadingStats reading,
       required int overallScore,
       String? aiSummary,
     }) = _StatsData;

     factory StatsData.fromJson(Map<String, dynamic> json) => _$StatsDataFromJson(json);
   }

   @freezed
   class ExerciseStats with _$ExerciseStats {
     factory ExerciseStats({
       required int totalSessions,
       required double totalMinutes,
       required double avgMinutesPerDay,
       required double totalDistance,
       required double totalCalories,
       required List<DailyData> dailyData,
     }) = _ExerciseStats;

     factory ExerciseStats.fromJson(Map<String, dynamic> json) => _$ExerciseStatsFromJson(json);
   }

   // ... å…¶ä»–Statsç±»ç±»ä¼¼

   @freezed
   class DailyData with _$DailyData {
     factory DailyData({
       required String date,
       required double value,
     }) = _DailyData;

     factory DailyData.fromJson(Map<String, dynamic> json) => _$DailyDataFromJson(json);
   }

   enum StatsPeriod { week, month }
   ```

4. åˆ›å»ºå›¾è¡¨ç»„ä»¶ï¼ˆä½¿ç”¨`fl_chart`ï¼‰ï¼š
   ```dart
   class ExerciseStatsCard extends StatelessWidget {
     final ExerciseStats data;

     Widget build(BuildContext context) {
       return Card(
         child: Padding(
           padding: EdgeInsets.all(16),
           child: Column(
             crossAxisAlignment: CrossAxisAlignment.start,
             children: [
               Text('è¿åŠ¨ç»Ÿè®¡', style: Theme.of(context).textTheme.titleLarge),
               SizedBox(height: 16),

               // å…³é”®æŒ‡æ ‡
               Row(
                 mainAxisAlignment: MainAxisAlignment.spaceAround,
                 children: [
                   _StatItem(
                     label: 'æ€»æ—¶é•¿',
                     value: '${data.totalMinutes.toInt()}åˆ†é’Ÿ',
                     icon: Icons.timer,
                   ),
                   _StatItem(
                     label: 'æ€»è·ç¦»',
                     value: '${data.totalDistance.toStringAsFixed(1)}km',
                     icon: Icons.route,
                   ),
                   _StatItem(
                     label: 'æ€»æ¶ˆè€—',
                     value: '${data.totalCalories.toInt()}kcal',
                     icon: Icons.local_fire_department,
                   ),
                 ],
               ),

               SizedBox(height: 24),

               // è¶‹åŠ¿å›¾è¡¨
               SizedBox(
                 height: 200,
                 child: LineChart(
                   LineChartData(
                     gridData: FlGridData(show: true),
                     titlesData: FlTitlesData(/* ... */),
                     borderData: FlBorderData(show: true),
                     lineBarsData: [
                       LineChartBarData(
                         spots: data.dailyData.asMap().entries.map((entry) {
                           return FlSpot(entry.key.toDouble(), entry.value.value);
                         }).toList(),
                         isCurved: true,
                         color: AppColors.exercise,
                         barWidth: 3,
                         dotData: FlDotData(show: true),
                       ),
                     ],
                   ),
                 ),
               ),
             ],
           ),
         ),
       );
     }
   }

   class _StatItem extends StatelessWidget {
     final String label;
     final String value;
     final IconData icon;

     Widget build(BuildContext context) {
       return Column(
         children: [
           Icon(icon, size: 32, color: AppColors.exercise),
           SizedBox(height: 8),
           Text(value, style: Theme.of(context).textTheme.titleMedium),
           Text(label, style: Theme.of(context).textTheme.bodySmall),
         ],
       );
     }
   }
   ```

**æµ‹è¯•éªŒæ”¶ï¼š**
- [ ] ç»Ÿè®¡é¡µé¢å¯ä»¥åŠ è½½å‘¨/æœˆæ•°æ®
- [ ] å„ç»´åº¦å›¾è¡¨æ­£ç¡®å±•ç¤º
- [ ] ç»¼åˆè¯„åˆ†è®¡ç®—åˆç†
- [ ] AIæ€»ç»“ä¸æ•°æ®ç›¸ç¬¦
- [ ] åˆ‡æ¢å‘¨æœŸæ—¶æ•°æ®æ­£ç¡®æ›´æ–°
- [ ] æ— æ•°æ®æ—¶æœ‰åˆç†ç¼ºçœå±•ç¤º

---

### Phase 4: è¾…åŠ©åŠŸèƒ½ï¼ˆP1ï¼Œé¢„è®¡1å‘¨ï¼‰

#### ä»»åŠ¡4.1ï¼šå®ç°æ˜æ—¥è®¡åˆ’æ¨¡å— ğŸ¯
**ä¼˜å…ˆçº§ï¼š** P1
**é¢„è®¡å·¥æ—¶ï¼š** 2å¤©
**ä¾èµ–ï¼š** ä»»åŠ¡2.1ï¼ˆAIæœåŠ¡ï¼‰ã€ä»»åŠ¡2.2ï¼ˆå¤œé—´å¤ç›˜ï¼‰

**åç«¯ä»»åŠ¡ï¼š**
1. æ–°å¢æ˜æ—¥è®¡åˆ’ç”Ÿæˆæ¥å£ï¼ˆ`server/src/routes/reviews.js`ï¼‰ï¼š
   ```javascript
   // POST /api/reviews/generate-plan
   router.post('/generate-plan', async (req, res, next) => {
     try {
       const userId = req.userId;
       const { reviewId } = req.body;  // åŸºäºæŸä¸ªå¤ç›˜ç”Ÿæˆ

       // 1. è·å–å¤ç›˜æ•°æ®
       const review = getReview(userId, reviewId);

       // 2. è·å–æœ€è¿‘ä¸€å‘¨çš„ç»Ÿè®¡æ•°æ®
       const recentStats = getRecentStats(userId, 7);

       // 3. è·å–ç”¨æˆ·ç›®æ ‡
       const userGoals = getUserGoals(userId);

       // 4. è°ƒç”¨AIç”Ÿæˆæ˜æ—¥è®¡åˆ’
       const plan = await aiService.generateTomorrowPlan({
         review,
         recentStats,
         goals: userGoals,
       });

       // 5. ä¿å­˜è®¡åˆ’åˆ°æ•°æ®åº“ï¼ˆå¯é€‰ï¼Œæˆ–ç›´æ¥è¿”å›ï¼‰
       savePlanToReview(reviewId, plan);

       res.json(plan);
     } catch (error) {
       next(error);
     }
   });
   ```

2. AI Promptè®¾è®¡ï¼ˆ`server/src/services/ai_service.js`ï¼‰ï¼š
   ```javascript
   async generateTomorrowPlan(userData) {
     const prompt = `
       ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„ç”Ÿæ´»æ•™ç»ƒï¼Œè¯·æ ¹æ®ä»¥ä¸‹ä¿¡æ¯ä¸ºç”¨æˆ·åˆ¶å®šæ˜æ—¥è¡ŒåŠ¨è®¡åˆ’ï¼š

       ## ä»Šæ—¥å¤ç›˜
       - äº®ç‚¹ï¼š${userData.review.highlights.join(', ')}
       - æ”¹è¿›ï¼š${userData.review.improvements.join(', ')}
       - ç»¼åˆè¯„åˆ†ï¼š${userData.review.overallScore}/100

       ## è¿‘æœŸè¡¨ç°
       - è¿åŠ¨ï¼šå¹³å‡${userData.recentStats.exercise.avgMinutesPerDay}åˆ†é’Ÿ/å¤©
       - ç¡çœ ï¼šå¹³å‡${userData.recentStats.sleep.avgHours}å°æ—¶/å¤©
       - å·¥ä½œä¸“æ³¨ï¼š${userData.recentStats.work.completionRate * 100}%å®Œæˆç‡

       ## ç”¨æˆ·ç›®æ ‡
       ${userData.goals.map(g => `- ${g.title}: ${g.target}`).join('\n')}

       è¯·ä»¥JSONæ ¼å¼è¿”å›æ˜æ—¥è®¡åˆ’ï¼š
       {
         "topThreeTasks": [
           { "task": "ä»»åŠ¡æè¿°", "priority": "high|medium|low", "estimatedMinutes": 60 }
         ],
         "healthSuggestions": {
           "exercise": "å»ºè®®çš„è¿åŠ¨å®‰æ’",
           "diet": "é¥®é£Ÿå»ºè®®",
           "sleep": "ç¡çœ å»ºè®®ï¼ˆç›®æ ‡å°±å¯æ—¶é—´ç­‰ï¼‰"
         },
         "readingSuggestion": "é˜…è¯»å»ºè®®ï¼ˆä¹¦ç±/æ—¶é•¿ç­‰ï¼‰",
         "motivationalQuote": "ä¸€å¥æ¿€åŠ±çš„è¯"
       }
     `;

     const response = await this.client.createChatCompletion({
       model: process.env.AI_MODEL,
       messages: [{ role: 'user', content: prompt }],
       temperature: 0.7,
     });

     return JSON.parse(response.data.choices[0].message.content);
   }
   ```

**å‰ç«¯ä»»åŠ¡ï¼š**
1. åˆ›å»ºæ˜æ—¥è®¡åˆ’é¡µé¢ï¼ˆ`lib/features/plans/presentation/tomorrow_plan_page.dart`ï¼‰ï¼š
   ```dart
   class TomorrowPlanPage extends ConsumerWidget {
     final String reviewId;

     Widget build(BuildContext context, WidgetRef ref) {
       final planAsync = ref.watch(tomorrowPlanProvider(reviewId));

       return Scaffold(
         appBar: AppBar(title: Text('æ˜æ—¥è®¡åˆ’')),
         body: planAsync.when(
           data: (plan) => _buildPlanContent(plan),
           loading: () => Center(child: CircularProgressIndicator()),
           error: (error, _) => ErrorView(error: error),
         ),
       );
     }

     Widget _buildPlanContent(TomorrowPlan plan) {
       return ListView(
         padding: EdgeInsets.all(16),
         children: [
           // æ¿€åŠ±è¯­
           MotivationalCard(quote: plan.motivationalQuote),

           // æœ€é‡è¦çš„ä¸‰ä»¶äº‹
           TopTasksCard(tasks: plan.topThreeTasks),

           // å¥åº·å»ºè®®
           HealthSuggestionsCard(suggestions: plan.healthSuggestions),

           // é˜…è¯»å»ºè®®
           ReadingSuggestionCard(suggestion: plan.readingSuggestion),
         ],
       );
     }
   }
   ```

2. åœ¨å¤œé—´å¤ç›˜æµç¨‹ä¸­é›†æˆï¼š
   - å¤ç›˜ä¿å­˜æˆåŠŸå â†’ è‡ªåŠ¨è§¦å‘æ˜æ—¥è®¡åˆ’ç”Ÿæˆ
   - æ˜¾ç¤º"æ­£åœ¨ä¸ºä½ è§„åˆ’æ˜å¤©..."åŠ è½½æç¤º
   - ç”Ÿæˆå®Œæ¯•åè·³è½¬åˆ°æ˜æ—¥è®¡åˆ’é¡µé¢

3. åœ¨Dashboardä¸­å±•ç¤ºï¼š
   - æ—©æ™¨æ‰“å¼€Appæ—¶ï¼Œåœ¨Dashboardé¡¶éƒ¨æ˜¾ç¤º"ä»Šæ—¥è®¡åˆ’"å¡ç‰‡
   - æ˜¾ç¤ºä»Šæ—¥çš„3ä¸ªé‡è¦ä»»åŠ¡
   - ç‚¹å‡»å¯æŸ¥çœ‹å®Œæ•´è®¡åˆ’è¯¦æƒ…

**æµ‹è¯•éªŒæ”¶ï¼š**
- [ ] å¤ç›˜å®Œæˆåå¯ä»¥ç”Ÿæˆæ˜æ—¥è®¡åˆ’
- [ ] è®¡åˆ’å†…å®¹ä¸å¤ç›˜æ•°æ®ç›¸å…³
- [ ] Dashboardæ­£ç¡®å±•ç¤ºä»Šæ—¥è®¡åˆ’
- [ ] å¯ä»¥æ ‡è®°ä»»åŠ¡å®Œæˆ
- [ ] æ¬¡æ—¥æ—©æ™¨æœ‰è®¡åˆ’æé†’é€šçŸ¥

---

#### ä»»åŠ¡4.2ï¼šå®ç°ç›®æ ‡ç®¡ç†åŠŸèƒ½ ğŸ¯
**ä¼˜å…ˆçº§ï¼š** P1
**é¢„è®¡å·¥æ—¶ï¼š** 3å¤©
**ä¾èµ–ï¼š** æ— 

**åç«¯ä»»åŠ¡ï¼š**
1. ç¡®è®¤æ•°æ®åº“è¡¨ï¼ˆå¯èƒ½å·²å­˜åœ¨ï¼‰ï¼š
   ```sql
   CREATE TABLE IF NOT EXISTS goals (
     id TEXT PRIMARY KEY,
     user_id TEXT NOT NULL,
     title TEXT NOT NULL,
     type TEXT NOT NULL,  -- health, work, reading, custom
     target_value REAL NOT NULL,
     target_unit TEXT NOT NULL,  -- times, minutes, pages, etc
     current_value REAL DEFAULT 0,
     period TEXT NOT NULL,  -- daily, weekly, monthly
     start_date TEXT NOT NULL,
     end_date TEXT,
     is_active INTEGER DEFAULT 1,
     created_at TEXT DEFAULT CURRENT_TIMESTAMP,
     updated_at TEXT DEFAULT CURRENT_TIMESTAMP,
     FOREIGN KEY (user_id) REFERENCES users(id)
   );
   ```

2. åˆ›å»ºç›®æ ‡APIï¼ˆ`server/src/routes/goals.js`ï¼‰ï¼š
   ```javascript
   const express = require('express');
   const { db } = require('../config/database');
   const authMiddleware = require('../middleware/auth');

   const router = express.Router();
   router.use(authMiddleware);

   // GET /api/goals - è·å–æ‰€æœ‰ç›®æ ‡
   router.get('/', (req, res, next) => { /* ... */ });

   // POST /api/goals - åˆ›å»ºç›®æ ‡
   router.post('/', (req, res, next) => { /* ... */ });

   // PUT /api/goals/:id - æ›´æ–°ç›®æ ‡
   router.put('/:id', (req, res, next) => { /* ... */ });

   // DELETE /api/goals/:id - åˆ é™¤ç›®æ ‡
   router.delete('/:id', (req, res, next) => { /* ... */ });

   // POST /api/goals/:id/progress - æ›´æ–°è¿›åº¦
   router.post('/:id/progress', (req, res, next) => {
     // æ ¹æ®å„ç»´åº¦çš„å®é™…è®°å½•ï¼Œè‡ªåŠ¨æ›´æ–°ç›®æ ‡è¿›åº¦
   });

   module.exports = router;
   ```

**å‰ç«¯ä»»åŠ¡ï¼š**
1. åˆ›å»ºç›®æ ‡ç®¡ç†Featureï¼ˆ`lib/features/goals/`ï¼‰ï¼š
   ```
   lib/features/goals/
   â”œâ”€â”€ presentation/
   â”‚   â”œâ”€â”€ goals_page.dart          # ç›®æ ‡åˆ—è¡¨
   â”‚   â”œâ”€â”€ add_goal_page.dart       # æ·»åŠ /ç¼–è¾‘ç›®æ ‡
   â”‚   â””â”€â”€ widgets/
   â”‚       â”œâ”€â”€ goal_card.dart
   â”‚       â””â”€â”€ goal_progress_chart.dart
   â”œâ”€â”€ application/
   â”‚   â””â”€â”€ goals_provider.dart
   â”œâ”€â”€ domain/
   â”‚   â””â”€â”€ goal_model.dart
   â””â”€â”€ data/
       â””â”€â”€ goals_repository.dart
   ```

2. ç›®æ ‡åˆ—è¡¨é¡µé¢ï¼š
   ```dart
   class GoalsPage extends ConsumerWidget {
     Widget build(BuildContext context, WidgetRef ref) {
       final goalsAsync = ref.watch(goalsProvider);

       return Scaffold(
         appBar: AppBar(
           title: Text('æˆ‘çš„ç›®æ ‡'),
           actions: [
             IconButton(
               icon: Icon(Icons.add),
               onPressed: () => context.push('/goals/add'),
             ),
           ],
         ),
         body: goalsAsync.when(
           data: (goals) {
             final activeGoals = goals.where((g) => g.isActive).toList();
             final completedGoals = goals.where((g) => !g.isActive).toList();

             return ListView(
               children: [
                 SectionHeader(title: 'è¿›è¡Œä¸­'),
                 ...activeGoals.map((goal) => GoalCard(goal: goal)),

                 SectionHeader(title: 'å·²å®Œæˆ'),
                 ...completedGoals.map((goal) => GoalCard(goal: goal)),
               ],
             );
           },
           loading: () => Center(child: CircularProgressIndicator()),
           error: (error, _) => ErrorView(error: error),
         ),
       );
     }
   }
   ```

3. ç›®æ ‡å¡ç‰‡ç»„ä»¶ï¼š
   ```dart
   class GoalCard extends StatelessWidget {
     final Goal goal;

     Widget build(BuildContext context) {
       final progress = goal.currentValue / goal.targetValue;

       return Card(
         child: ListTile(
           leading: Icon(goal.type.icon, color: goal.type.color),
           title: Text(goal.title),
           subtitle: Column(
             crossAxisAlignment: CrossAxisAlignment.start,
             children: [
               Text('ç›®æ ‡: ${goal.targetValue} ${goal.targetUnit} / ${goal.period.name}'),
               SizedBox(height: 8),
               LinearProgressIndicator(
                 value: progress.clamp(0.0, 1.0),
                 backgroundColor: Colors.grey[300],
                 valueColor: AlwaysStoppedAnimation(goal.type.color),
               ),
               Text('${(progress * 100).toInt()}% å®Œæˆ'),
             ],
           ),
           trailing: IconButton(
             icon: Icon(Icons.more_vert),
             onPressed: () => _showOptions(context, goal),
           ),
         ),
       );
     }
   }
   ```

4. æ·»åŠ ç›®æ ‡é¡µé¢ï¼š
   ```dart
   class AddGoalPage extends ConsumerStatefulWidget {
     @override
     ConsumerState<AddGoalPage> createState() => _AddGoalPageState();
   }

   class _AddGoalPageState extends ConsumerState<AddGoalPage> {
     final _formKey = GlobalKey<FormState>();

     String _title = '';
     GoalType _type = GoalType.health;
     double _targetValue = 0;
     GoalPeriod _period = GoalPeriod.weekly;

     Widget build(BuildContext context) {
       return Scaffold(
         appBar: AppBar(title: Text('æ·»åŠ ç›®æ ‡')),
         body: Form(
           key: _formKey,
           child: ListView(
             padding: EdgeInsets.all(16),
             children: [
               TextFormField(
                 decoration: InputDecoration(labelText: 'ç›®æ ‡åç§°'),
                 onChanged: (value) => _title = value,
               ),

               DropdownButtonFormField<GoalType>(
                 value: _type,
                 decoration: InputDecoration(labelText: 'ç›®æ ‡ç±»å‹'),
                 items: GoalType.values.map((type) {
                   return DropdownMenuItem(
                     value: type,
                     child: Row(
                       children: [
                         Icon(type.icon),
                         SizedBox(width: 8),
                         Text(type.displayName),
                       ],
                     ),
                   );
                 }).toList(),
                 onChanged: (value) => setState(() => _type = value!),
               ),

               TextFormField(
                 decoration: InputDecoration(labelText: 'ç›®æ ‡å€¼'),
                 keyboardType: TextInputType.number,
                 onChanged: (value) => _targetValue = double.tryParse(value) ?? 0,
               ),

               SegmentedButton<GoalPeriod>(
                 segments: [
                   ButtonSegment(value: GoalPeriod.daily, label: Text('æ¯æ—¥')),
                   ButtonSegment(value: GoalPeriod.weekly, label: Text('æ¯å‘¨')),
                   ButtonSegment(value: GoalPeriod.monthly, label: Text('æ¯æœˆ')),
                 ],
                 selected: {_period},
                 onSelectionChanged: (Set<GoalPeriod> newSelection) {
                   setState(() => _period = newSelection.first);
                 },
               ),

               SizedBox(height: 32),

               ElevatedButton(
                 onPressed: _saveGoal,
                 child: Text('ä¿å­˜ç›®æ ‡'),
               ),
             ],
           ),
         ),
       );
     }

     Future<void> _saveGoal() async {
       if (!_formKey.currentState!.validate()) return;

       final goal = Goal(
         id: Uuid().v4(),
         userId: ref.read(authProvider).userId!,
         title: _title,
         type: _type,
         targetValue: _targetValue,
         targetUnit: _type.defaultUnit,
         period: _period,
         startDate: DateTime.now(),
         isActive: true,
       );

       await ref.read(goalsProvider.notifier).addGoal(goal);
       context.pop();
     }
   }
   ```

5. ç›®æ ‡è¿½è¸ªè‡ªåŠ¨åŒ–ï¼š
   - å½“ç”¨æˆ·è®°å½•è¿åŠ¨/é˜…è¯»/å·¥ä½œæ—¶ï¼Œè‡ªåŠ¨æ›´æ–°å¯¹åº”ç›®æ ‡çš„è¿›åº¦
   - åœ¨å„è®°å½•æ¨¡å—çš„Repositoryä¸­æ·»åŠ ç›®æ ‡æ›´æ–°é€»è¾‘
   - ç›®æ ‡å®Œæˆæ—¶æ˜¾ç¤ºåº†ç¥åŠ¨ç”»

**æµ‹è¯•éªŒæ”¶ï¼š**
- [ ] å¯ä»¥æ·»åŠ /ç¼–è¾‘/åˆ é™¤ç›®æ ‡
- [ ] ç›®æ ‡åˆ—è¡¨æ­£ç¡®å±•ç¤º
- [ ] è¿›åº¦æ¡æ­£ç¡®åæ˜ å®Œæˆæƒ…å†µ
- [ ] è®°å½•æ•°æ®æ—¶ç›®æ ‡è‡ªåŠ¨æ›´æ–°
- [ ] ç›®æ ‡å®Œæˆæ—¶æœ‰æç¤º
- [ ] Dashboardå±•ç¤ºå½“å‰ç›®æ ‡è¿›åº¦

---

#### ä»»åŠ¡4.3ï¼šå®ç°æ•°æ®å¯¼å‡ºä¸æ¸…ç† ğŸ’¾
**ä¼˜å…ˆçº§ï¼š** P1
**é¢„è®¡å·¥æ—¶ï¼š** 2å¤©
**ä¾èµ–ï¼š** æ— 

**åç«¯ä»»åŠ¡ï¼š**
1. æ•°æ®å¯¼å‡ºAPIï¼ˆ`server/src/routes/profile.js`ï¼‰ï¼š
   ```javascript
   const archiver = require('archiver');  // ç”¨äºç”Ÿæˆzipæ–‡ä»¶

   // GET /api/profile/export-data
   router.get('/export-data', authenticate, async (req, res, next) => {
     try {
       const userId = req.userId;

       // 1. å¯¼å‡ºæ‰€æœ‰ç”¨æˆ·æ•°æ®
       const userData = {
         profile: getUserProfile(userId),
         workouts: getAllWorkouts(userId),
         meals: getAllMeals(userId),
         sleep: getAllSleep(userId),
         focus: getAllFocus(userId),
         reading: getAllReading(userId),
         reviews: getAllReviews(userId),
         goals: getAllGoals(userId),
         moments: getAllMoments(userId),
       };

       // 2. ç”ŸæˆJSONæ–‡ä»¶
       const jsonData = JSON.stringify(userData, null, 2);

       // 3. è®¾ç½®å“åº”å¤´
       res.setHeader('Content-Type', 'application/json');
       res.setHeader('Content-Disposition', `attachment; filename="coach_daily_data_${Date.now()}.json"`);

       res.send(jsonData);
     } catch (error) {
       next(error);
     }
   });
   ```

2. è´¦æˆ·åˆ é™¤APIï¼š
   ```javascript
   // DELETE /api/profile/delete-account
   router.delete('/delete-account', authenticate, async (req, res, next) => {
     const transaction = db.transaction((userId) => {
       // åˆ é™¤æ‰€æœ‰ç›¸å…³æ•°æ®
       db.prepare('DELETE FROM workout_records WHERE user_id = ?').run(userId);
       db.prepare('DELETE FROM meal_records WHERE user_id = ?').run(userId);
       db.prepare('DELETE FROM sleep_records WHERE user_id = ?').run(userId);
       db.prepare('DELETE FROM focus_sessions WHERE user_id = ?').run(userId);
       db.prepare('DELETE FROM reading_records WHERE user_id = ?').run(userId);
       db.prepare('DELETE FROM review_entries WHERE user_id = ?').run(userId);
       db.prepare('DELETE FROM goals WHERE user_id = ?').run(userId);
       db.prepare('DELETE FROM moments WHERE user_id = ?').run(userId);

       // æœ€ååˆ é™¤ç”¨æˆ·
       db.prepare('DELETE FROM users WHERE id = ?').run(userId);
     });

     try {
       transaction(req.userId);
       res.json({ success: true, message: 'è´¦æˆ·å·²åˆ é™¤' });
     } catch (error) {
       next(error);
     }
   });
   ```

**å‰ç«¯ä»»åŠ¡ï¼š**
1. åœ¨è®¾ç½®é¡µé¢æ·»åŠ å…¥å£ï¼ˆ`lib/features/profile/presentation/profile_page.dart`ï¼‰ï¼š
   ```dart
   // åœ¨è®¾ç½®åˆ—è¡¨ä¸­æ·»åŠ 
   ListTile(
     leading: Icon(Icons.download, color: AppColors.primary),
     title: Text('å¯¼å‡ºæ•°æ®'),
     subtitle: Text('ä¸‹è½½æ‰€æœ‰è®°å½•æ•°æ®'),
     onTap: () => _exportData(),
   ),

   ListTile(
     leading: Icon(Icons.delete_forever, color: AppColors.error),
     title: Text('åˆ é™¤è´¦æˆ·'),
     subtitle: Text('æ°¸ä¹…åˆ é™¤è´¦æˆ·åŠæ‰€æœ‰æ•°æ®'),
     onTap: () => _confirmDeleteAccount(),
   ),
   ```

2. æ•°æ®å¯¼å‡ºå®ç°ï¼š
   ```dart
   Future<void> _exportData() async {
     try {
       showDialog(
         context: context,
         barrierDismissible: false,
         builder: (context) => AlertDialog(
           content: Row(
             children: [
               CircularProgressIndicator(),
               SizedBox(width: 16),
               Text('æ­£åœ¨å¯¼å‡ºæ•°æ®...'),
             ],
           ),
         ),
       );

       final apiClient = ref.read(apiClientProvider);
       final response = await apiClient.get(
         '/api/profile/export-data',
         options: Options(responseType: ResponseType.bytes),
       );

       // ä¿å­˜åˆ°æœ¬åœ°æ–‡ä»¶
       final directory = await getApplicationDocumentsDirectory();
       final file = File('${directory.path}/coach_daily_backup_${DateTime.now().millisecondsSinceEpoch}.json');
       await file.writeAsBytes(response.data);

       Navigator.pop(context);

       // åˆ†äº«æ–‡ä»¶
       await Share.shareXFiles([XFile(file.path)], text: 'æˆ‘çš„æ—¥å¸¸æ•™ç»ƒæ•°æ®å¤‡ä»½');

       showSuccessSnackBar('æ•°æ®å¯¼å‡ºæˆåŠŸ');
     } catch (e) {
       Navigator.pop(context);
       showErrorSnackBar('å¯¼å‡ºå¤±è´¥: $e');
     }
   }
   ```

3. è´¦æˆ·åˆ é™¤å®ç°ï¼š
   ```dart
   Future<void> _confirmDeleteAccount() async {
     final confirmed = await showDialog<bool>(
       context: context,
       builder: (context) => AlertDialog(
         title: Text('ç¡®è®¤åˆ é™¤è´¦æˆ·'),
         content: Text('æ­¤æ“ä½œä¸å¯æ¢å¤ï¼æ‰€æœ‰æ•°æ®å°†è¢«æ°¸ä¹…åˆ é™¤ã€‚\n\nå»ºè®®å…ˆå¯¼å‡ºæ•°æ®å¤‡ä»½ã€‚\n\nè¯·è¾“å…¥ "åˆ é™¤" ä»¥ç¡®è®¤ï¼š'),
         actions: [
           TextButton(
             onPressed: () => Navigator.pop(context, false),
             child: Text('å–æ¶ˆ'),
           ),
           TextButton(
             onPressed: () async {
               // å¼¹å‡ºè¾“å…¥æ¡†ç¡®è®¤
               final input = await _showInputDialog();
               if (input == 'åˆ é™¤') {
                 Navigator.pop(context, true);
               } else {
                 showErrorSnackBar('è¾“å…¥ä¸åŒ¹é…');
               }
             },
             child: Text('ç¡®è®¤åˆ é™¤', style: TextStyle(color: AppColors.error)),
           ),
         ],
       ),
     );

     if (confirmed == true) {
       await _deleteAccount();
     }
   }

   Future<void> _deleteAccount() async {
     try {
       final apiClient = ref.read(apiClientProvider);
       await apiClient.delete('/api/profile/delete-account');

       // æ¸…é™¤æœ¬åœ°æ•°æ®
       await ref.read(localStoreProvider).clear();
       await ref.read(preferencesServiceProvider).clear();

       // è·³è½¬åˆ°ç™»å½•é¡µ
       context.go('/login');

       showSuccessSnackBar('è´¦æˆ·å·²åˆ é™¤');
     } catch (e) {
       showErrorSnackBar('åˆ é™¤å¤±è´¥: $e');
     }
   }
   ```

**æµ‹è¯•éªŒæ”¶ï¼š**
- [ ] å¯ä»¥æˆåŠŸå¯¼å‡ºæ•°æ®
- [ ] å¯¼å‡ºçš„JSONåŒ…å«æ‰€æœ‰æ¨¡å—æ•°æ®
- [ ] å¯ä»¥åˆ†äº«å¯¼å‡ºçš„æ–‡ä»¶
- [ ] è´¦æˆ·åˆ é™¤éœ€è¦äºŒæ¬¡ç¡®è®¤
- [ ] åˆ é™¤åæ‰€æœ‰æ•°æ®è¢«æ¸…é™¤
- [ ] åˆ é™¤åè‡ªåŠ¨é€€å‡ºç™»å½•

---

## äº”ã€å¼€å‘ä¼˜å…ˆçº§å»ºè®®

### ğŸ”´ é«˜ä¼˜å…ˆçº§ï¼ˆP0ï¼‰- ç«‹å³å¼€å‘
è¿™äº›åŠŸèƒ½å½±å“æ ¸å¿ƒä½“éªŒï¼Œå¿…é¡»å°½å¿«å®Œæˆï¼š

1. **é˜…è¯»è®°å½•æ¨¡å—** (3å¤©)
   - å½±å“Dashboardå®Œæ•´æ€§
   - éœ€æ±‚æ–‡æ¡£P0åŠŸèƒ½

2. **é€šçŸ¥ç³»ç»Ÿ** (4å¤©)
   - å¤œé—´å¤ç›˜æé†’æ˜¯æ ¸å¿ƒåŠŸèƒ½
   - ç”¨æˆ·ç•™å­˜çš„å…³é”®

3. **å¤œé—´å¤ç›˜AIåŠŸèƒ½** (5å¤©)
   - äº§å“æ ¸å¿ƒå·®å¼‚åŒ–åŠŸèƒ½
   - ç”¨æˆ·ä»·å€¼æœ€é«˜

4. **ç»¼åˆç»Ÿè®¡æ¨¡å—** (5å¤©)
   - éœ€æ±‚æ–‡æ¡£P0åŠŸèƒ½
   - ç”¨æˆ·é•¿æœŸç•™å­˜çš„å…³é”®

**é¢„è®¡æ€»å·¥æ—¶ï¼š** 17å¤© (çº¦3.5å‘¨)

---

### ğŸŸ¡ ä¸­ä¼˜å…ˆçº§ï¼ˆP1ï¼‰- è¿‘æœŸè§„åˆ’
è¿™äº›åŠŸèƒ½æå‡ä½“éªŒï¼Œåº”åœ¨MVPåç»­ç‰ˆæœ¬ä¸­å®Œæˆï¼š

1. **AIé£Ÿç‰©è¯†åˆ«** (4å¤©)
   - æå‡é¥®é£Ÿè®°å½•ä½“éªŒ
   - æŠ€æœ¯äº®ç‚¹

2. **æ˜æ—¥è®¡åˆ’æ¨¡å—** (2å¤©)
   - éœ€æ±‚æ–‡æ¡£P1åŠŸèƒ½
   - ä¸å¤ç›˜åŠŸèƒ½é…åˆ

3. **ç›®æ ‡ç®¡ç†** (3å¤©)
   - å¢å¼ºç”¨æˆ·ç²˜æ€§
   - æ¸¸æˆåŒ–è®¾è®¡

4. **æ•°æ®å¯¼å‡ºä¸æ¸…ç†** (2å¤©)
   - éšç§åˆè§„è¦æ±‚
   - ç”¨æˆ·ä¿¡ä»»

**é¢„è®¡æ€»å·¥æ—¶ï¼š** 11å¤© (çº¦2å‘¨)

---

### ğŸŸ¢ ä½ä¼˜å…ˆçº§ - åç»­è¿­ä»£
è¿™äº›åŠŸèƒ½å¯ä»¥åœ¨äº§å“ç¨³å®šåé€æ­¥æ·»åŠ ï¼š

1. å¤ç›˜å†å²ç¼–è¾‘åŠŸèƒ½
2. é«˜çº§ç»Ÿè®¡åŠŸèƒ½ï¼ˆè¶‹åŠ¿é¢„æµ‹ã€å¼‚å¸¸æ£€æµ‹ï¼‰
3. ç¤¾äº¤åŠŸèƒ½ï¼ˆåˆ†äº«ã€æ‰“å¡åœˆï¼‰
4. å¤šè®¾å¤‡åŒæ­¥ä¼˜åŒ–
5. å°ç»„ä»¶ï¼ˆWidgetï¼‰
6. Apple Watch / å¯ç©¿æˆ´è®¾å¤‡é›†æˆ

---

## å…­ã€å¼€å‘è·¯çº¿å›¾

### Sprint 1 (Week 1-2): æ ¸å¿ƒåŠŸèƒ½è¡¥å…¨
- [x] é˜…è¯»è®°å½•æ¨¡å—
- [x] Dashboardå¿«é€Ÿè®°å½•ä¼˜åŒ–

### Sprint 2 (Week 3-4): é€šçŸ¥ä¸AIåŸºç¡€
- [ ] é€šçŸ¥ç³»ç»Ÿå®ç°
- [ ] AIæœåŠ¡åŸºç¡€è®¾æ–½

### Sprint 3 (Week 5-6): AIåŠŸèƒ½é›†æˆ
- [ ] å¤œé—´å¤ç›˜AIåŠŸèƒ½
- [ ] AIé£Ÿç‰©è¯†åˆ«

### Sprint 4 (Week 7-8): ç»Ÿè®¡ä¸åˆ†æ
- [ ] ç»¼åˆç»Ÿè®¡æ¨¡å—
- [ ] AIå‘¨æœŸæ€»ç»“

### Sprint 5 (Week 9-10): è¾…åŠ©åŠŸèƒ½
- [ ] æ˜æ—¥è®¡åˆ’æ¨¡å—
- [ ] ç›®æ ‡ç®¡ç†
- [ ] æ•°æ®å¯¼å‡ºä¸æ¸…ç†

### Sprint 6 (Week 11-12): æµ‹è¯•ä¸ä¼˜åŒ–
- [ ] å…¨åŠŸèƒ½æµ‹è¯•
- [ ] æ€§èƒ½ä¼˜åŒ–
- [ ] UI/UXä¼˜åŒ–
- [ ] Bugä¿®å¤

---

## ä¸ƒã€æŠ€æœ¯å€ºåŠ¡ä¸é£é™©

### æŠ€æœ¯å€ºåŠ¡
1. **MomentsåŠŸèƒ½** - ä¸åœ¨éœ€æ±‚æ–‡æ¡£ä¸­ï¼Œè€ƒè™‘æ˜¯å¦ä¿ç•™æˆ–æ•´åˆ
2. **ç¦»çº¿åŒæ­¥æœºåˆ¶** - å½“å‰å®ç°å¯èƒ½ä¸å¤Ÿå¥å£®ï¼Œéœ€åŠ å¼º
3. **é”™è¯¯å¤„ç†** - éœ€è¦ç»Ÿä¸€çš„é”™è¯¯å¤„ç†æœºåˆ¶
4. **æ—¥å¿—ç³»ç»Ÿ** - éœ€è¦å®Œå–„çš„æ—¥å¿—å’Œç›‘æ§

### é£é™©ç‚¹
1. **AIæœåŠ¡æˆæœ¬** - å¤§é‡ç”¨æˆ·ä½¿ç”¨æ—¶APIè°ƒç”¨è´¹ç”¨å¯èƒ½è¾ƒé«˜
2. **AIå“åº”é€Ÿåº¦** - éœ€è¦ä¼˜åŒ–Promptå’Œæ¨¡å‹é€‰æ‹©
3. **å›¾åƒè¯†åˆ«å‡†ç¡®åº¦** - éœ€è¦æµ‹è¯•å¹¶ä¼˜åŒ–è¯†åˆ«æ•ˆæœ
4. **é€šçŸ¥æƒé™** - iOS/Androidæƒé™ç­–ç•¥ä¸åŒï¼Œéœ€åˆ†åˆ«å¤„ç†

---

## å…«ã€éªŒæ”¶æ ‡å‡†

### MVPå®Œæˆæ ‡å‡†
- [ ] ç”¨æˆ·å¯ä»¥æ³¨å†Œ/ç™»å½•
- [ ] å¯ä»¥è®°å½•æ‰€æœ‰5ä¸ªç»´åº¦çš„æ•°æ®ï¼ˆè¿åŠ¨/é¥®é£Ÿ/ç¡çœ /å·¥ä½œ/é˜…è¯»ï¼‰
- [ ] å¤œé—´å¤ç›˜å¯ä»¥ç”ŸæˆAIæŠ¥å‘Š
- [ ] ç»Ÿè®¡é¡µé¢å±•ç¤ºæ‰€æœ‰ç»´åº¦è¶‹åŠ¿
- [ ] é€šçŸ¥ç³»ç»Ÿæ­£å¸¸å·¥ä½œ
- [ ] æ‰€æœ‰P0åŠŸèƒ½æµ‹è¯•é€šè¿‡
- [ ] æ— é˜»å¡æ€§Bug

### ç”Ÿäº§å°±ç»ªæ ‡å‡†
- [ ] æ‰€æœ‰P1åŠŸèƒ½å®Œæˆ
- [ ] æ€§èƒ½æµ‹è¯•é€šè¿‡ï¼ˆåŠ è½½æ—¶é—´<3sï¼‰
- [ ] ç¦»çº¿åŠŸèƒ½æ­£å¸¸
- [ ] é”™è¯¯å¤„ç†å®Œå–„
- [ ] æ—¥å¿—ç³»ç»Ÿå®Œå–„
- [ ] éšç§æ”¿ç­–å’Œç”¨æˆ·åè®®å®Œæˆ
- [ ] App Store/Google Playå®¡æ ¸ææ–™å‡†å¤‡

---

## ä¹ã€ä¸‹ä¸€æ­¥è¡ŒåŠ¨

### ç«‹å³å¼€å§‹
1. **ç¡®è®¤æŠ€æœ¯é€‰å‹ï¼š**
   - é€‰æ‹©AIæœåŠ¡æä¾›å•†ï¼ˆæ¨èï¼šæ–‡å¿ƒä¸€è¨€æˆ–é€šä¹‰åƒé—®ï¼‰
   - é€‰æ‹©å›¾åƒè¯†åˆ«æœåŠ¡ï¼ˆæ¨èï¼šç™¾åº¦AIï¼‰
   - æ³¨å†ŒAPIè´¦å·ï¼Œè·å–å¯†é’¥

2. **ç¯å¢ƒé…ç½®ï¼š**
   - é…ç½®AIæœåŠ¡ç¯å¢ƒå˜é‡
   - å®‰è£…å¿…è¦çš„ä¾èµ–åŒ…
   - æµ‹è¯•APIè¿é€šæ€§

3. **å¼€å§‹å¼€å‘ï¼š**
   - ä»"ä»»åŠ¡1.1ï¼šå®ç°é˜…è¯»è®°å½•æ¨¡å—"å¼€å§‹
   - æŒ‰ç…§æœ¬è®¡åˆ’è¡¨é€æ­¥æ¨è¿›
   - æ¯å®Œæˆä¸€ä¸ªä»»åŠ¡ï¼Œæ›´æ–°è®¡åˆ’è¡¨çŠ¶æ€

### åä½œå»ºè®®
- å‰ç«¯å’Œåç«¯å¯ä»¥å¹¶è¡Œå¼€å‘
- å…ˆå®ŒæˆåŸºç¡€APIï¼Œå†å¼€å‘UI
- æ¯ä¸ªFeatureå®Œæˆåè¿›è¡Œé›†æˆæµ‹è¯•
- å®šæœŸReviewä»£ç è´¨é‡

---

**è®¡åˆ’è¡¨åˆ›å»ºå®Œæ¯•ï¼** ğŸ‰

è¯·æŒ‰ç…§ä¼˜å…ˆçº§å¼€å§‹å®æ–½ï¼Œç¥å¼€å‘é¡ºåˆ©ï¼
